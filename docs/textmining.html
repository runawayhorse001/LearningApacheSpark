

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>14. Text Mining &mdash; Learning Apache Spark with Python  documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/icon.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/fix_rtd.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="15. Social Network Analysis" href="socialnetwork.html" />
    <link rel="prev" title="13. RFM Analysis" href="rfm.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Learning Apache Spark with Python
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">1. Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="why.html">2. Why Spark with Python ?</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">3. Configure Running Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">4. An Introduction to Apache Spark</a></li>
<li class="toctree-l1"><a class="reference internal" href="rdd.html">5. Programming with RDDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="stats.html">6. Statistics and Linear Algebra Preliminaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="exploration.html">7. Data Exploration</a></li>
<li class="toctree-l1"><a class="reference internal" href="manipulation.html">8. Data Manipulation: Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="regression.html">9. Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="reg.html">10. Regularization</a></li>
<li class="toctree-l1"><a class="reference internal" href="classification.html">11. Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="clustering.html">12. Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="rfm.html">13. RFM Analysis</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">14. Text Mining</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#text-collection">14.1. Text Collection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#image-to-text">14.1.1. Image to text</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-enhnaced-to-text">14.1.2. Image Enhnaced to text</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pdf-to-text">14.1.3. PDF to text</a></li>
<li class="toctree-l3"><a class="reference internal" href="#audio-to-text">14.1.4. Audio to text</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#text-preprocessing">14.2. Text Preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#text-classification">14.3. Text Classification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">14.3.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#demo">14.3.2. Demo</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sentiment-analysis">14.4. Sentiment analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">14.4.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pipeline">14.4.2. Pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">14.4.3. Demo</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#n-grams-and-correlations">14.5. N-grams and Correlations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#topic-model-latent-dirichlet-allocation">14.6. Topic Model: Latent Dirichlet Allocation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">14.6.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">14.6.2. Demo</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="socialnetwork.html">15. Social Network Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="als.html">16. ALS: Stock Portfolio Recommendations</a></li>
<li class="toctree-l1"><a class="reference internal" href="mc.html">17. Monte Carlo Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcmc.html">18. Markov Chain Monte Carlo</a></li>
<li class="toctree-l1"><a class="reference internal" href="fnn.html">19. Neural Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="auto.html">20. Automation for Cloudera Distribution Hadoop</a></li>
<li class="toctree-l1"><a class="reference internal" href="pack.html">21. Wrap PySpark Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="audit.html">22. PySpark Data Audit Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="ze2nb.html">23. Zeppelin to jupyter notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="cheat.html">24. My Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="jdbc.html">25. JDBC Connection</a></li>
<li class="toctree-l1"><a class="reference internal" href="bricks.html">26. Databricks Tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">27. PySpark API</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">28. Main Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Learning Apache Spark with Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li><span class="section-number">14. </span>Text Mining</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="text-mining">
<span id="textmining"></span><h1><span class="section-number">14. </span>Text Mining<a class="headerlink" href="#text-mining" title="Permalink to this headline">¶</a></h1>
<div class="admonition-chinese-proverb admonition">
<p class="admonition-title">Chinese proverb</p>
<p><strong>Articles showed more than intended.</strong>  – Xianglong Shen</p>
</div>
<div class="figure align-center">
<img alt="_images/sen_word_freq.png" src="_images/sen_word_freq.png" />
</div>
<div class="section" id="text-collection">
<span id="textcollection"></span><h2><span class="section-number">14.1. </span>Text Collection<a class="headerlink" href="#text-collection" title="Permalink to this headline">¶</a></h2>
<div class="section" id="image-to-text">
<span id="img2text"></span><h3><span class="section-number">14.1.1. </span>Image to text<a class="headerlink" href="#image-to-text" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>My <code class="docutils literal notranslate"><span class="pre">img2txt</span></code> function</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">img2txt</span><span class="p">(</span><span class="n">img_dir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convert images to text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">PythonMagick</span>
    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
    <span class="kn">import</span> <span class="nn">PyPDF2</span>

    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
    <span class="kn">import</span> <span class="nn">pytesseract</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;doc4img.txt&#39;</span><span class="p">,</span><span class="s1">&#39;wa&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="p">[</span><span class="n">img_file</span> <span class="k">for</span> <span class="n">img_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">img_dir</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">img_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="n">img_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="n">img_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.jpeg&quot;</span><span class="p">))]:</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="n">input_img</span> <span class="o">=</span> <span class="n">img_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">img</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------------------------------------------------------------------&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Converting &#39;</span> <span class="o">+</span> <span class="n">img</span> <span class="o">+</span><span class="s1">&#39;.......&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------------------------------------------------------------------&#39;</span><span class="p">)</span>

        <span class="c1"># extract the text information from images</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">input_img</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># ouput text file</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">img</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>


        <span class="nb">print</span> <span class="s2">&quot;CPU Time for converting&quot;</span> <span class="o">+</span> <span class="n">img</span> <span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Demo</p></li>
</ul>
<p>I applied my <code class="docutils literal notranslate"><span class="pre">img2txt</span></code> function to the  image in <a class="reference external" href="static/feng.pdf_0.png">Image folder</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">image_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;Image&quot;</span>

<span class="n">img2txt</span><span class="p">(</span><span class="n">image_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>Then I got the following results:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--------------------------------------------------------------------
feng.pdf_0.png
Converting feng.pdf_0.png.......
--------------------------------------------------------------------
l I l w

Wenqiang Feng
Data Scientist
DST APPLIED ANALYTICS GROUP



Wenqiang Feng is Data Scientist <span class="k">for</span> DST’s Applied Analytics Group. Dr. Feng’s responsibilities
include providing DST clients with access to cutting—edge skills and technologies, including Big
Data analytic solutions, advanced analytic and data enhancement techniques and modeling.

Dr. Feng has deep analytic expertise in data mining, analytic systems, machine learning
algorithms, business intelligence, and applying Big Data tools to strategically solve industry
problems in a cross—functional business. Before joining the DST Applied Analytics Group, Dr.
Feng holds a MA Data Science Fellow at The Institute <span class="k">for</span> Mathematics and Its Applications
<span class="o">{</span>IMA<span class="o">)</span> at the University of Minnesota. While there, he helped startup companies make
marketing decisions based on deep predictive analytics.

Dr. Feng graduated from University of Tennessee, Knoxville with PhD in Computational
mathematics and Master’s degree in Statistics. He also holds Master’s degree in Computational
Mathematics at Missouri University of Science and Technology <span class="o">(</span>MST<span class="o">)</span> and Master’s degree in
Applied Mathematics at University of science and technology of China <span class="o">(</span>USTC<span class="o">)</span>.
CPU Time <span class="k">for</span> convertingfeng.pdf_0.png:0:00:02.061208
</pre></div>
</div>
</div>
<div class="section" id="image-enhnaced-to-text">
<h3><span class="section-number">14.1.2. </span>Image Enhnaced to text<a class="headerlink" href="#image-enhnaced-to-text" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>My <code class="docutils literal notranslate"><span class="pre">img2txt_enhance</span></code> function</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">img2txt_enhance</span><span class="p">(</span><span class="n">img_dir</span><span class="p">,</span><span class="n">scaler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convert images files to text</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">PythonMagick</span>
    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
    <span class="kn">import</span> <span class="nn">PyPDF2</span>

    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageEnhance</span><span class="p">,</span> <span class="n">ImageFilter</span>
    <span class="kn">import</span> <span class="nn">pytesseract</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;doc4img.txt&#39;</span><span class="p">,</span><span class="s1">&#39;wa&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="p">[</span><span class="n">img_file</span> <span class="k">for</span> <span class="n">img_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">img_dir</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">img_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="n">img_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="n">img_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.jpeg&quot;</span><span class="p">))]:</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="n">input_img</span> <span class="o">=</span> <span class="n">img_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">img</span>
        <span class="n">enhanced_img</span> <span class="o">=</span> <span class="n">img_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span><span class="s2">&quot;Enhanced&quot;</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="o">+</span> <span class="n">img</span>

        <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">input_img</span><span class="p">)</span> <span class="c1"># the second one</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ImageFilter</span><span class="o">.</span><span class="n">MedianFilter</span><span class="p">())</span>
        <span class="n">enhancer</span> <span class="o">=</span> <span class="n">ImageEnhance</span><span class="o">.</span><span class="n">Contrast</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">enhancer</span><span class="o">.</span><span class="n">enhance</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="n">im</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">enhanced_img</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">scaler</span><span class="p">):</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">enhanced_img</span><span class="p">)</span> <span class="c1"># the second one</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ImageFilter</span><span class="o">.</span><span class="n">MedianFilter</span><span class="p">())</span>
            <span class="n">enhancer</span> <span class="o">=</span> <span class="n">ImageEnhance</span><span class="o">.</span><span class="n">Contrast</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">enhancer</span><span class="o">.</span><span class="n">enhance</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
            <span class="n">im</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">enhanced_img</span><span class="p">)</span>



        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------------------------------------------------------------------&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Converting &#39;</span> <span class="o">+</span> <span class="n">img</span> <span class="o">+</span><span class="s1">&#39;.......&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------------------------------------------------------------------&#39;</span><span class="p">)</span>

        <span class="c1"># extract the text information from images</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">enhanced_img</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># ouput text file</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">img</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>


        <span class="nb">print</span> <span class="s2">&quot;CPU Time for converting&quot;</span> <span class="o">+</span> <span class="n">img</span> <span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Demo</p></li>
</ul>
<p>I applied my <code class="docutils literal notranslate"><span class="pre">img2txt_enhance</span></code> function to the following noised image in <a class="reference external" href="images/noised.jpg">Enhance folder</a>.</p>
<div class="figure align-center">
<img alt="_images/noised.jpg" src="_images/noised.jpg" />
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">image_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;Enhance&quot;</span>

<span class="n">pdf2txt_enhance</span><span class="p">(</span><span class="n">image_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>Then I got the following results:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--------------------------------------------------------------------
noised.jpg
Converting noised.jpg.......
--------------------------------------------------------------------
zHHH
CPU Time <span class="k">for</span> convertingnoised.jpg:0:00:00.135465
</pre></div>
</div>
<p>while the result from <code class="docutils literal notranslate"><span class="pre">img2txt</span></code> function is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--------------------------------------------------------------------
noised.jpg
Converting noised.jpg.......
--------------------------------------------------------------------
,2 WW
CPU Time <span class="k">for</span> convertingnoised.jpg:0:00:00.133508
</pre></div>
</div>
<p>which is not correct.</p>
</div>
<div class="section" id="pdf-to-text">
<span id="pdf2text"></span><h3><span class="section-number">14.1.3. </span>PDF to text<a class="headerlink" href="#pdf-to-text" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>My <code class="docutils literal notranslate"><span class="pre">pdf2txt</span></code> function</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pdf2txt</span><span class="p">(</span><span class="n">pdf_dir</span><span class="p">,</span><span class="n">image_dir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    convert PDF to text</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">PythonMagick</span>
    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
    <span class="kn">import</span> <span class="nn">PyPDF2</span>

    <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
    <span class="kn">import</span> <span class="nn">pytesseract</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;doc.txt&#39;</span><span class="p">,</span><span class="s1">&#39;wa&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">pdf</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pdf_file</span> <span class="k">for</span> <span class="n">pdf_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">pdf_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">pdf_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.pdf&quot;</span><span class="p">)]:</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="n">input_pdf</span> <span class="o">=</span> <span class="n">pdf_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">pdf</span>

        <span class="n">pdf_im</span> <span class="o">=</span> <span class="n">PyPDF2</span><span class="o">.</span><span class="n">PdfFileReader</span><span class="p">(</span><span class="n">file</span><span class="p">(</span><span class="n">input_pdf</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
        <span class="n">npage</span> <span class="o">=</span> <span class="n">pdf_im</span><span class="o">.</span><span class="n">getNumPages</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------------------------------------------------------------------&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pdf</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Converting </span><span class="si">%d</span><span class="s1"> pages.&#39;</span> <span class="o">%</span> <span class="n">npage</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------------------------------------------------------------------&#39;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--------------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">npage</span><span class="p">):</span>

            <span class="n">pdf_file</span> <span class="o">=</span> <span class="n">input_pdf</span> <span class="o">+</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39;]&#39;</span>
            <span class="n">image_file</span> <span class="o">=</span>  <span class="n">image_dir</span>  <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">pdf</span><span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39;.png&#39;</span>

            <span class="c1"># convert PDF files to Images</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">PythonMagick</span><span class="o">.</span><span class="n">Image</span><span class="p">()</span>
            <span class="n">im</span><span class="o">.</span><span class="n">density</span><span class="p">(</span><span class="s1">&#39;300&#39;</span><span class="p">)</span>
            <span class="n">im</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">pdf_file</span><span class="p">)</span>
            <span class="n">im</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>

            <span class="c1"># extract the text information from images</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_string</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_file</span><span class="p">))</span>

            <span class="c1">#print(text)</span>

            <span class="c1"># ouput text file</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">pdf</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>


        <span class="nb">print</span> <span class="s2">&quot;CPU Time for converting&quot;</span> <span class="o">+</span> <span class="n">pdf</span> <span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Demo</p></li>
</ul>
<p>I applied my <code class="docutils literal notranslate"><span class="pre">pdf2txt</span></code> function to my scaned bio pdf file in <a class="reference external" href="static/pdf">pdf folder</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pdf_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;pdf&quot;</span>
<span class="n">image_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;Image&quot;</span>

<span class="n">pdf2txt</span><span class="p">(</span><span class="n">pdf_dir</span><span class="p">,</span><span class="n">image_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>Then I got the following results:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>--------------------------------------------------------------------
feng.pdf
Converting <span class="m">1</span> pages.
--------------------------------------------------------------------
l I l w

Wenqiang Feng
Data Scientist
DST APPLIED ANALYTICS GROUP



Wenqiang Feng is Data Scientist <span class="k">for</span> DST’s Applied Analytics Group. Dr. Feng’s responsibilities
include providing DST clients with access to cutting—edge skills and technologies, including Big
Data analytic solutions, advanced analytic and data enhancement techniques and modeling.

Dr. Feng has deep analytic expertise in data mining, analytic systems, machine learning
algorithms, business intelligence, and applying Big Data tools to strategically solve industry
problems in a cross—functional business. Before joining the DST Applied Analytics Group, Dr.
Feng holds a MA Data Science Fellow at The Institute <span class="k">for</span> Mathematics and Its Applications
<span class="o">{</span>IMA<span class="o">)</span> at the University of Minnesota. While there, he helped startup companies make
marketing decisions based on deep predictive analytics.

Dr. Feng graduated from University of Tennessee, Knoxville with PhD in Computational
mathematics and Master’s degree in Statistics. He also holds Master’s degree in Computational
Mathematics at Missouri University of Science and Technology <span class="o">(</span>MST<span class="o">)</span> and Master’s degree in
Applied Mathematics at University of science and technology of China <span class="o">(</span>USTC<span class="o">)</span>.
CPU Time <span class="k">for</span> convertingfeng.pdf:0:00:03.143800
</pre></div>
</div>
</div>
<div class="section" id="audio-to-text">
<span id="audio2text"></span><h3><span class="section-number">14.1.4. </span>Audio to text<a class="headerlink" href="#audio-to-text" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>My <code class="docutils literal notranslate"><span class="pre">audio2txt</span></code> function</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">audio2txt</span><span class="p">(</span><span class="n">audio_dir</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; convert audio to text&#39;&#39;&#39;</span>

    <span class="kn">import</span> <span class="nn">speech_recognition</span> <span class="k">as</span> <span class="nn">sr</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">Recognizer</span><span class="p">()</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;doc.txt&#39;</span><span class="p">,</span><span class="s1">&#39;wa&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">audio_n</span> <span class="ow">in</span> <span class="p">[</span><span class="n">audio_file</span> <span class="k">for</span> <span class="n">audio_file</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">audio_dir</span><span class="p">)</span> \
                  <span class="k">if</span> <span class="n">audio_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.wav&quot;</span><span class="p">)]:</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">audio_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">audio_n</span>

        <span class="c1"># Read audio data</span>
        <span class="k">with</span> <span class="n">sr</span><span class="o">.</span><span class="n">AudioFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">audio</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>  <span class="c1"># read the entire audio file</span>

        <span class="c1"># Google Speech Recognition</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recognize_google</span><span class="p">(</span><span class="n">audio</span><span class="p">)</span>

        <span class="c1"># ouput text file</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">audio_n</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You said: &#39;</span> <span class="o">+</span> <span class="n">text</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Demo</p></li>
</ul>
<p>I applied my <code class="docutils literal notranslate"><span class="pre">audio2txt</span></code> function to my audio records in <a class="reference external" href="static/audio">audio folder</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">audio_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;audio&quot;</span>

<span class="n">audio2txt</span><span class="p">(</span><span class="n">audio_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>Then I got the following results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">You</span> <span class="n">said</span><span class="p">:</span> <span class="n">hello</span> <span class="n">this</span> <span class="ow">is</span> <span class="n">George</span> <span class="n">welcome</span> <span class="n">to</span> <span class="n">my</span> <span class="n">tutorial</span>
<span class="n">You</span> <span class="n">said</span><span class="p">:</span> <span class="n">mathematics</span> <span class="ow">is</span> <span class="n">important</span> <span class="ow">in</span> <span class="n">daily</span> <span class="n">life</span>
<span class="n">You</span> <span class="n">said</span><span class="p">:</span> <span class="n">call</span> <span class="n">me</span> <span class="n">tomorrow</span>
<span class="n">You</span> <span class="n">said</span><span class="p">:</span> <span class="n">do</span> <span class="n">you</span> <span class="n">want</span> <span class="n">something</span> <span class="n">to</span> <span class="n">eat</span>
<span class="n">You</span> <span class="n">said</span><span class="p">:</span> <span class="n">I</span> <span class="n">want</span> <span class="n">to</span> <span class="n">speak</span> <span class="k">with</span> <span class="n">him</span>
<span class="n">You</span> <span class="n">said</span><span class="p">:</span> <span class="n">nice</span> <span class="n">to</span> <span class="n">see</span> <span class="n">you</span>
<span class="n">You</span> <span class="n">said</span><span class="p">:</span> <span class="n">can</span> <span class="n">you</span> <span class="n">speak</span> <span class="n">slowly</span>
<span class="n">You</span> <span class="n">said</span><span class="p">:</span> <span class="n">have</span> <span class="n">a</span> <span class="n">good</span> <span class="n">day</span>
</pre></div>
</div>
<p>By the way, you can use my following python code to record your own audio and play with <code class="docutils literal notranslate"><span class="pre">audio2txt</span></code> function in Command-line <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">record.py</span> <span class="pre">&quot;demo2.wav&quot;</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">getopt</span>

<span class="kn">import</span> <span class="nn">speech_recognition</span> <span class="k">as</span> <span class="nn">sr</span>

<span class="n">audio_filename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">sr</span><span class="o">.</span><span class="n">Recognizer</span><span class="p">()</span>
<span class="k">with</span> <span class="n">sr</span><span class="o">.</span><span class="n">Microphone</span><span class="p">()</span> <span class="k">as</span> <span class="n">source</span><span class="p">:</span>
    <span class="n">r</span><span class="o">.</span><span class="n">adjust_for_ambient_noise</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hey there, say something, I am recording!&quot;</span><span class="p">)</span>
    <span class="n">audio</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done listening!&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">audio_filename</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">audio</span><span class="o">.</span><span class="n">get_wav_data</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="text-preprocessing">
<span id="textpreprocessing"></span><h2><span class="section-number">14.2. </span>Text Preprocessing<a class="headerlink" href="#text-preprocessing" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>check to see if a row only contains whitespace</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_blanks</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="n">is_blank</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_str</span><span class="o">.</span><span class="n">isspace</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">is_blank</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Determine whether the language of the text content is english or not: Use langid module to classify the language to make sure we are applying the correct cleanup actions for English langid</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_lang</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="n">predict_lang</span> <span class="o">=</span> <span class="n">langid</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">data_str</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">predict_lang</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">.</span><span class="mi">9</span><span class="p">:</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">predict_lang</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">language</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
    <span class="k">return</span> <span class="n">language</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Remove features</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">remove_features</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="c1"># compile regex</span>
    <span class="n">url_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;https?://(www.)?\w+\.\w+(/\w+)*/?&#39;</span><span class="p">)</span>
    <span class="n">punc_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">))</span>
    <span class="n">num_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(</span><span class="se">\\</span><span class="s1">d+)&#39;</span><span class="p">)</span>
    <span class="n">mention_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;@(\w+)&#39;</span><span class="p">)</span>
    <span class="n">alpha_num_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^[a-z0-9_.]+$&quot;</span><span class="p">)</span>
    <span class="c1"># convert to lowercase</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">data_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c1"># remove hyperlinks</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">url_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="c1"># remove @mentions</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">mention_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="c1"># remove puncuation</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">punc_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="c1"># remove numeric &#39;words&#39;</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">num_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="c1"># remove non a-z 0-9 characters and words shorter than 3 characters</span>
    <span class="n">list_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cleaned_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">data_str</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">list_pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alpha_num_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">word</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alpha_num_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">cleaned_str</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">word</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
        <span class="n">list_pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">cleaned_str</span>
</pre></div>
</div>
<ul class="simple">
<li><p>removes stop words</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">remove_stops</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="c1"># expects a string</span>
    <span class="n">stops</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s2">&quot;english&quot;</span><span class="p">))</span>
    <span class="n">list_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cleaned_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">data_str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stops</span><span class="p">:</span>
            <span class="c1"># rebuild cleaned_str</span>
            <span class="k">if</span> <span class="n">list_pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">word</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">cleaned_str</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">word</span>
            <span class="n">list_pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">cleaned_str</span>
</pre></div>
</div>
<ul class="simple">
<li><p>tagging text</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">tag_and_remove</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="n">cleaned_str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
    <span class="c1"># noun tags</span>
    <span class="n">nn_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NN&#39;</span><span class="p">,</span> <span class="s1">&#39;NNP&#39;</span><span class="p">,</span> <span class="s1">&#39;NNP&#39;</span><span class="p">,</span> <span class="s1">&#39;NNPS&#39;</span><span class="p">,</span> <span class="s1">&#39;NNS&#39;</span><span class="p">]</span>
    <span class="c1"># adjectives</span>
    <span class="n">jj_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;JJ&#39;</span><span class="p">,</span> <span class="s1">&#39;JJR&#39;</span><span class="p">,</span> <span class="s1">&#39;JJS&#39;</span><span class="p">]</span>
    <span class="c1"># verbs</span>
    <span class="n">vb_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;VB&#39;</span><span class="p">,</span> <span class="s1">&#39;VBD&#39;</span><span class="p">,</span> <span class="s1">&#39;VBG&#39;</span><span class="p">,</span> <span class="s1">&#39;VBN&#39;</span><span class="p">,</span> <span class="s1">&#39;VBP&#39;</span><span class="p">,</span> <span class="s1">&#39;VBZ&#39;</span><span class="p">]</span>
    <span class="n">nltk_tags</span> <span class="o">=</span> <span class="n">nn_tags</span> <span class="o">+</span> <span class="n">jj_tags</span> <span class="o">+</span> <span class="n">vb_tags</span>

    <span class="c1"># break string into &#39;words&#39;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">data_str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="c1"># tag the text and keep only those with the right tags</span>
    <span class="n">tagged_text</span> <span class="o">=</span> <span class="n">pos_tag</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tagged_word</span> <span class="ow">in</span> <span class="n">tagged_text</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tagged_word</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">nltk_tags</span><span class="p">:</span>
            <span class="n">cleaned_str</span> <span class="o">+=</span> <span class="n">tagged_word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>

    <span class="k">return</span> <span class="n">cleaned_str</span>
</pre></div>
</div>
<ul class="simple">
<li><p>lemmatization</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">lemmatize</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="c1"># expects a string</span>
    <span class="n">list_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cleaned_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">lmtzr</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">data_str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">tagged_words</span> <span class="o">=</span> <span class="n">pos_tag</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">tagged_words</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;v&#39;</span> <span class="ow">in</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">lemma</span> <span class="o">=</span> <span class="n">lmtzr</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lemma</span> <span class="o">=</span> <span class="n">lmtzr</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">list_pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">lemma</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">cleaned_str</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">lemma</span>
        <span class="n">list_pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">cleaned_str</span>
</pre></div>
</div>
<p><strong>define the preprocessing function in PySpark</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">udf</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StringType</span>
<span class="kn">import</span> <span class="nn">preproc</span> <span class="k">as</span> <span class="nn">pp</span>

<span class="n">check_lang_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">check_lang</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">remove_stops_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">remove_stops</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">remove_features_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">remove_features</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">tag_and_remove_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">tag_and_remove</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">lemmatize_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">check_blanks_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">check_blanks</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="text-classification">
<span id="textclassification"></span><h2><span class="section-number">14.3. </span>Text Classification<a class="headerlink" href="#text-classification" title="Permalink to this headline">¶</a></h2>
<p>Theoretically speaking, you may apply any classification algorithms to do classification. I will only
present Naive Bayes method is the following.</p>
<div class="figure align-center">
<img alt="_images/text_classification.png" src="_images/text_classification.png" />
</div>
<div class="section" id="introduction">
<h3><span class="section-number">14.3.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="demo">
<h3><span class="section-number">14.3.2. </span>Demo<a class="headerlink" href="#demo" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>create spark contexts</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyspark</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SQLContext</span>

<span class="c1"># create spark contexts</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">pyspark</span><span class="o">.</span><span class="n">SparkContext</span><span class="p">()</span>
<span class="n">sqlContext</span> <span class="o">=</span> <span class="n">SQLContext</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>load dataset</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load a text file and convert each line to a Row.</span>
<span class="n">data_rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="s2">&quot;../data/raw_data.txt&quot;</span><span class="p">)</span>
<span class="n">parts_rdd</span> <span class="o">=</span> <span class="n">data_rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">))</span>

<span class="c1"># Filter bad rows out</span>
<span class="n">garantee_col_rdd</span> <span class="o">=</span> <span class="n">parts_rdd</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">l</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">typed_rdd</span> <span class="o">=</span> <span class="n">garantee_col_rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>

<span class="c1">#Create DataFrame</span>
<span class="n">data_df</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">typed_rdd</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">])</span>

<span class="c1"># get the raw columns</span>
<span class="n">raw_cols</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">columns</span>

<span class="c1">#data_df.show()</span>
<span class="n">data_df</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">root</span>
 <span class="o">|--</span> <span class="n">text</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
 <span class="o">|--</span> <span class="nb">id</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
 <span class="o">|--</span> <span class="n">label</span><span class="p">:</span> <span class="n">double</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+------------------+-----+</span>
<span class="o">|</span>                <span class="n">text</span><span class="o">|</span>                <span class="nb">id</span><span class="o">|</span><span class="n">label</span><span class="o">|</span>
<span class="o">+--------------------+------------------+-----+</span>
<span class="o">|</span><span class="n">Fresh</span> <span class="n">install</span> <span class="n">of</span> <span class="o">...|</span>        <span class="mi">1018769417</span><span class="o">|</span>  <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span><span class="n">Well</span><span class="o">.</span> <span class="n">Now</span> <span class="n">I</span> <span class="n">know</span> <span class="o">...|</span>       <span class="mi">10284216536</span><span class="o">|</span>  <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span><span class="s2">&quot;Literally six we...|       10298589026|  1.0|</span>
<span class="o">|</span><span class="n">Mitsubishi</span> <span class="n">i</span> <span class="n">MiEV</span><span class="o">...|</span><span class="mi">109017669432377344</span><span class="o">|</span>  <span class="mf">1.0</span><span class="o">|</span>
<span class="o">+--------------------+------------------+-----+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">4</span> <span class="n">rows</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>setup pyspark udf function</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">udf</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StringType</span>
<span class="kn">import</span> <span class="nn">preproc</span> <span class="k">as</span> <span class="nn">pp</span>

<span class="c1"># Register all the functions in Preproc with Spark Context</span>
<span class="n">check_lang_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">check_lang</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">remove_stops_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">remove_stops</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">remove_features_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">remove_features</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">tag_and_remove_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">tag_and_remove</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">lemmatize_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">check_blanks_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">check_blanks</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>language identification</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lang_df</span> <span class="o">=</span> <span class="n">data_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;lang&quot;</span><span class="p">,</span> <span class="n">check_lang_udf</span><span class="p">(</span><span class="n">data_df</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]))</span>
<span class="n">en_df</span> <span class="o">=</span> <span class="n">lang_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">lang_df</span><span class="p">[</span><span class="s2">&quot;lang&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">)</span>
<span class="n">en_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>+--------------------+------------------+-----+----+
<span class="p">|</span>                text<span class="p">|</span>                id<span class="p">|</span>label<span class="p">|</span>lang<span class="p">|</span>
+--------------------+------------------+-----+----+
<span class="p">|</span>RT @goeentertain:...<span class="p">|</span><span class="m">665305154954989568</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>  en<span class="p">|</span>
<span class="p">|</span>Teforia Uses Mach...<span class="p">|</span><span class="m">660668007975268352</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>  en<span class="p">|</span>
<span class="p">|</span>   Apple TV or Roku?<span class="p">|</span>       <span class="m">25842461136</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>  en<span class="p">|</span>
<span class="p">|</span>Finished http://t...<span class="p">|</span>        <span class="m">9412369614</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>  en<span class="p">|</span>
+--------------------+------------------+-----+----+
only showing top <span class="m">4</span> rows
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li><p>remove stop words</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rm_stops_df</span> <span class="o">=</span> <span class="n">en_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">raw_cols</span><span class="p">)</span>\
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;stop_text&quot;</span><span class="p">,</span> <span class="n">remove_stops_udf</span><span class="p">(</span><span class="n">en_df</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]))</span>
<span class="n">rm_stops_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>+--------------------+------------------+-----+--------------------+
<span class="p">|</span>                text<span class="p">|</span>                id<span class="p">|</span>label<span class="p">|</span>           stop_text<span class="p">|</span>
+--------------------+------------------+-----+--------------------+
<span class="p">|</span>RT @goeentertain:...<span class="p">|</span><span class="m">665305154954989568</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>RT @goeentertain:...<span class="p">|</span>
<span class="p">|</span>Teforia Uses Mach...<span class="p">|</span><span class="m">660668007975268352</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>Teforia Uses Mach...<span class="p">|</span>
<span class="p">|</span>   Apple TV or Roku?<span class="p">|</span>       <span class="m">25842461136</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>      Apple TV Roku?<span class="p">|</span>
<span class="p">|</span>Finished http://t...<span class="p">|</span>        <span class="m">9412369614</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>Finished http://t...<span class="p">|</span>
+--------------------+------------------+-----+--------------------+
only showing top <span class="m">4</span> rows
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li><p>remove irrelevant features</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rm_features_df</span> <span class="o">=</span> <span class="n">rm_stops_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">raw_cols</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;stop_text&quot;</span><span class="p">])</span>\
                            <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;feat_text&quot;</span><span class="p">,</span> \
                            <span class="n">remove_features_udf</span><span class="p">(</span><span class="n">rm_stops_df</span><span class="p">[</span><span class="s2">&quot;stop_text&quot;</span><span class="p">]))</span>
<span class="n">rm_features_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>+--------------------+------------------+-----+--------------------+--------------------+
<span class="p">|</span>                text<span class="p">|</span>                id<span class="p">|</span>label<span class="p">|</span>           stop_text<span class="p">|</span>           feat_text<span class="p">|</span>
+--------------------+------------------+-----+--------------------+--------------------+
<span class="p">|</span>RT @goeentertain:...<span class="p">|</span><span class="m">665305154954989568</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>RT @goeentertain:...<span class="p">|</span>  future blase   ...<span class="p">|</span>
<span class="p">|</span>Teforia Uses Mach...<span class="p">|</span><span class="m">660668007975268352</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>Teforia Uses Mach...<span class="p">|</span>teforia uses mach...<span class="p">|</span>
<span class="p">|</span>   Apple TV or Roku?<span class="p">|</span>       <span class="m">25842461136</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>      Apple TV Roku?<span class="p">|</span>         apple  roku<span class="p">|</span>
<span class="p">|</span>Finished http://t...<span class="p">|</span>        <span class="m">9412369614</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>Finished http://t...<span class="p">|</span>            finished<span class="p">|</span>
+--------------------+------------------+-----+--------------------+--------------------+
only showing top <span class="m">4</span> rows
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>tag the words</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tagged_df</span> <span class="o">=</span> <span class="n">rm_features_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">raw_cols</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;feat_text&quot;</span><span class="p">])</span> \
                          <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;tagged_text&quot;</span><span class="p">,</span> \
                           <span class="n">tag_and_remove_udf</span><span class="p">(</span><span class="n">rm_features_df</span><span class="o">.</span><span class="n">feat_text</span><span class="p">))</span>

<span class="n">tagged_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>+--------------------+------------------+-----+--------------------+--------------------+
<span class="p">|</span>                text<span class="p">|</span>                id<span class="p">|</span>label<span class="p">|</span>           feat_text<span class="p">|</span>         tagged_text<span class="p">|</span>
+--------------------+------------------+-----+--------------------+--------------------+
<span class="p">|</span>RT @goeentertain:...<span class="p">|</span><span class="m">665305154954989568</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>  future blase   ...<span class="p">|</span> future blase vic...<span class="p">|</span>
<span class="p">|</span>Teforia Uses Mach...<span class="p">|</span><span class="m">660668007975268352</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>teforia uses mach...<span class="p">|</span> teforia uses mac...<span class="p">|</span>
<span class="p">|</span>   Apple TV or Roku?<span class="p">|</span>       <span class="m">25842461136</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>         apple  roku<span class="p">|</span>         apple roku <span class="p">|</span>
<span class="p">|</span>Finished http://t...<span class="p">|</span>        <span class="m">9412369614</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>            finished<span class="p">|</span>           finished <span class="p">|</span>
+--------------------+------------------+-----+--------------------+--------------------+
only showing top <span class="m">4</span> rows
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li><p>lemmatization of words</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lemm_df</span> <span class="o">=</span> <span class="n">tagged_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">raw_cols</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;tagged_text&quot;</span><span class="p">])</span> \
                   <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;lemm_text&quot;</span><span class="p">,</span> <span class="n">lemmatize_udf</span><span class="p">(</span><span class="n">tagged_df</span><span class="p">[</span><span class="s2">&quot;tagged_text&quot;</span><span class="p">]))</span>
<span class="n">lemm_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>+--------------------+------------------+-----+--------------------+--------------------+
<span class="p">|</span>                text<span class="p">|</span>                id<span class="p">|</span>label<span class="p">|</span>         tagged_text<span class="p">|</span>           lemm_text<span class="p">|</span>
+--------------------+------------------+-----+--------------------+--------------------+
<span class="p">|</span>RT @goeentertain:...<span class="p">|</span><span class="m">665305154954989568</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span> future blase vic...<span class="p">|</span>future blase vice...<span class="p">|</span>
<span class="p">|</span>Teforia Uses Mach...<span class="p">|</span><span class="m">660668007975268352</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span> teforia uses mac...<span class="p">|</span>teforia use machi...<span class="p">|</span>
<span class="p">|</span>   Apple TV or Roku?<span class="p">|</span>       <span class="m">25842461136</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>         apple roku <span class="p">|</span>          apple roku<span class="p">|</span>
<span class="p">|</span>Finished http://t...<span class="p">|</span>        <span class="m">9412369614</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>           finished <span class="p">|</span>              finish<span class="p">|</span>
+--------------------+------------------+-----+--------------------+--------------------+
only showing top <span class="m">4</span> rows
</pre></div>
</div>
<ol class="arabic simple" start="9">
<li><p>remove blank rows and drop duplicates</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">check_blanks_df</span> <span class="o">=</span> <span class="n">lemm_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">raw_cols</span><span class="o">+</span><span class="p">[</span><span class="s2">&quot;lemm_text&quot;</span><span class="p">])</span>\
                             <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;is_blank&quot;</span><span class="p">,</span> <span class="n">check_blanks_udf</span><span class="p">(</span><span class="n">lemm_df</span><span class="p">[</span><span class="s2">&quot;lemm_text&quot;</span><span class="p">]))</span>
    <span class="c1"># remove blanks</span>
    <span class="n">no_blanks_df</span> <span class="o">=</span> <span class="n">check_blanks_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">check_blanks_df</span><span class="p">[</span><span class="s2">&quot;is_blank&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span>

<span class="c1"># drop duplicates</span>
<span class="n">dedup_df</span> <span class="o">=</span> <span class="n">no_blanks_df</span><span class="o">.</span><span class="n">dropDuplicates</span><span class="p">([</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">])</span>

    <span class="n">dedup_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>+--------------------+------------------+-----+--------------------+--------+
<span class="p">|</span>                text<span class="p">|</span>                id<span class="p">|</span>label<span class="p">|</span>           lemm_text<span class="p">|</span>is_blank<span class="p">|</span>
+--------------------+------------------+-----+--------------------+--------+
<span class="p">|</span>RT @goeentertain:...<span class="p">|</span><span class="m">665305154954989568</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>future blase vice...<span class="p">|</span>   False<span class="p">|</span>
<span class="p">|</span>Teforia Uses Mach...<span class="p">|</span><span class="m">660668007975268352</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>teforia use machi...<span class="p">|</span>   False<span class="p">|</span>
<span class="p">|</span>   Apple TV or Roku?<span class="p">|</span>       <span class="m">25842461136</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>          apple roku<span class="p">|</span>   False<span class="p">|</span>
<span class="p">|</span>Finished http://t...<span class="p">|</span>        <span class="m">9412369614</span><span class="p">|</span>  <span class="m">1</span>.0<span class="p">|</span>              finish<span class="p">|</span>   False<span class="p">|</span>
+--------------------+------------------+-----+--------------------+--------+
only showing top <span class="m">4</span> rows
</pre></div>
</div>
<ol class="arabic simple" start="10">
<li><p>add unieuq ID</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">monotonically_increasing_id</span>
<span class="c1"># Create Unique ID</span>
<span class="n">dedup_df</span> <span class="o">=</span> <span class="n">dedup_df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="n">monotonically_increasing_id</span><span class="p">())</span>
<span class="n">dedup_df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+------------------+-----+--------------------+--------+------------+</span>
<span class="o">|</span>                <span class="n">text</span><span class="o">|</span>                <span class="nb">id</span><span class="o">|</span><span class="n">label</span><span class="o">|</span>           <span class="n">lemm_text</span><span class="o">|</span><span class="n">is_blank</span><span class="o">|</span>         <span class="n">uid</span><span class="o">|</span>
<span class="o">+--------------------+------------------+-----+--------------------+--------+------------+</span>
<span class="o">|</span>              <span class="n">dragon</span><span class="o">|</span>        <span class="mi">1546813742</span><span class="o">|</span>  <span class="mf">1.0</span><span class="o">|</span>              <span class="n">dragon</span><span class="o">|</span>   <span class="kc">False</span><span class="o">|</span> <span class="mi">85899345920</span><span class="o">|</span>
<span class="o">|</span>           <span class="n">hurt</span> <span class="n">much</span><span class="o">|</span>        <span class="mi">1558492525</span><span class="o">|</span>  <span class="mf">1.0</span><span class="o">|</span>           <span class="n">hurt</span> <span class="n">much</span><span class="o">|</span>   <span class="kc">False</span><span class="o">|</span><span class="mi">111669149696</span><span class="o">|</span>
<span class="o">|</span><span class="n">seth</span> <span class="n">blog</span> <span class="n">word</span> <span class="n">se</span><span class="o">...|</span><span class="mi">383221484023709697</span><span class="o">|</span>  <span class="mf">1.0</span><span class="o">|</span><span class="n">seth</span> <span class="n">blog</span> <span class="n">word</span> <span class="n">se</span><span class="o">...|</span>   <span class="kc">False</span><span class="o">|</span><span class="mi">128849018880</span><span class="o">|</span>
<span class="o">|</span><span class="n">teforia</span> <span class="n">use</span> <span class="n">machi</span><span class="o">...|</span><span class="mi">660668007975268352</span><span class="o">|</span>  <span class="mf">1.0</span><span class="o">|</span><span class="n">teforia</span> <span class="n">use</span> <span class="n">machi</span><span class="o">...|</span>   <span class="kc">False</span><span class="o">|</span><span class="mi">137438953472</span><span class="o">|</span>
<span class="o">+--------------------+------------------+-----+--------------------+--------+------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">4</span> <span class="n">rows</span>
</pre></div>
</div>
<ol class="arabic simple" start="11">
<li><p>create final dataset</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">dedup_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;uid&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+------------+------------------+--------------------+-----+</span>
<span class="o">|</span>         <span class="n">uid</span><span class="o">|</span>                <span class="nb">id</span><span class="o">|</span>                <span class="n">text</span><span class="o">|</span><span class="n">label</span><span class="o">|</span>
<span class="o">+------------+------------------+--------------------+-----+</span>
<span class="o">|</span> <span class="mi">85899345920</span><span class="o">|</span>        <span class="mi">1546813742</span><span class="o">|</span>              <span class="n">dragon</span><span class="o">|</span>  <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span><span class="mi">111669149696</span><span class="o">|</span>        <span class="mi">1558492525</span><span class="o">|</span>           <span class="n">hurt</span> <span class="n">much</span><span class="o">|</span>  <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span><span class="mi">128849018880</span><span class="o">|</span><span class="mi">383221484023709697</span><span class="o">|</span><span class="n">seth</span> <span class="n">blog</span> <span class="n">word</span> <span class="n">se</span><span class="o">...|</span>  <span class="mf">1.0</span><span class="o">|</span>
<span class="o">|</span><span class="mi">137438953472</span><span class="o">|</span><span class="mi">660668007975268352</span><span class="o">|</span><span class="n">teforia</span> <span class="n">use</span> <span class="n">machi</span><span class="o">...|</span>  <span class="mf">1.0</span><span class="o">|</span>
<span class="o">+------------+------------------+--------------------+-----+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">4</span> <span class="n">rows</span>
</pre></div>
</div>
<ol class="arabic simple" start="12">
<li><p>Create taining and test sets</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Split the data into training and test sets (40% held out for testing)</span>
<span class="p">(</span><span class="n">trainingData</span><span class="p">,</span> <span class="n">testData</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
</pre></div>
</div>
<ol class="arabic simple" start="13">
<li><p>NaiveBayes Pipeline</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">HashingTF</span><span class="p">,</span> <span class="n">IDF</span><span class="p">,</span> <span class="n">Tokenizer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">NaiveBayes</span><span class="p">,</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">MulticlassClassificationEvaluator</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.tuning</span> <span class="kn">import</span> <span class="n">ParamGridBuilder</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.tuning</span> <span class="kn">import</span> <span class="n">CrossValidator</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">IndexToString</span><span class="p">,</span> <span class="n">StringIndexer</span><span class="p">,</span> <span class="n">VectorIndexer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>

<span class="c1"># Configure an ML pipeline, which consists of tree stages: tokenizer, hashingTF, and nb.</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">)</span>
<span class="n">hashingTF</span> <span class="o">=</span> <span class="n">HashingTF</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">getOutputCol</span><span class="p">(),</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;rawFeatures&quot;</span><span class="p">)</span>
<span class="c1"># vectorizer = CountVectorizer(inputCol= &quot;words&quot;, outputCol=&quot;rawFeatures&quot;)</span>
<span class="n">idf</span> <span class="o">=</span> <span class="n">IDF</span><span class="p">(</span><span class="n">minDocFreq</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;rawFeatures&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>

<span class="c1"># Naive Bayes model</span>
<span class="n">nb</span> <span class="o">=</span> <span class="n">NaiveBayes</span><span class="p">()</span>

<span class="c1"># Pipeline Architecture</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">hashingTF</span><span class="p">,</span> <span class="n">idf</span><span class="p">,</span> <span class="n">nb</span><span class="p">])</span>

<span class="c1"># Train model.  This also runs the indexers.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingData</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="14">
<li><p>Make predictions</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testData</span><span class="p">)</span>

<span class="c1"># Select example rows to display.</span>
<span class="n">predictions</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;prediction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+-----------------------------------------------+-----+----------+</span>
<span class="o">|</span><span class="n">text</span>                                           <span class="o">|</span><span class="n">label</span><span class="o">|</span><span class="n">prediction</span><span class="o">|</span>
<span class="o">+-----------------------------------------------+-----+----------+</span>
<span class="o">|</span><span class="n">finish</span>                                         <span class="o">|</span><span class="mf">1.0</span>  <span class="o">|</span><span class="mf">1.0</span>       <span class="o">|</span>
<span class="o">|</span><span class="n">meet</span> <span class="n">rolo</span> <span class="n">dogsofthinkgeek</span> <span class="n">happy</span> <span class="n">nationaldogday</span> <span class="o">|</span><span class="mf">1.0</span>  <span class="o">|</span><span class="mf">1.0</span>       <span class="o">|</span>
<span class="o">|</span><span class="n">pumpkin</span> <span class="n">family</span>                                 <span class="o">|</span><span class="mf">1.0</span>  <span class="o">|</span><span class="mf">1.0</span>       <span class="o">|</span>
<span class="o">|</span><span class="n">meet</span> <span class="n">jet</span> <span class="n">dogsofthinkgeek</span> <span class="n">happy</span> <span class="n">nationaldogday</span>  <span class="o">|</span><span class="mf">1.0</span>  <span class="o">|</span><span class="mf">1.0</span>       <span class="o">|</span>
<span class="o">|</span><span class="n">meet</span> <span class="n">vixie</span> <span class="n">dogsofthinkgeek</span> <span class="n">happy</span> <span class="n">nationaldogday</span><span class="o">|</span><span class="mf">1.0</span>  <span class="o">|</span><span class="mf">1.0</span>       <span class="o">|</span>
<span class="o">+-----------------------------------------------+-----+----------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<ol class="arabic simple" start="15">
<li><p>evaluation</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">MulticlassClassificationEvaluator</span>
<span class="n">evaluator</span> <span class="o">=</span> <span class="n">MulticlassClassificationEvaluator</span><span class="p">(</span><span class="n">predictionCol</span><span class="o">=</span><span class="s2">&quot;prediction&quot;</span><span class="p">)</span>
<span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mf">0.912655971479501</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sentiment-analysis">
<span id="sentimentanalysis"></span><h2><span class="section-number">14.4. </span>Sentiment analysis<a class="headerlink" href="#sentiment-analysis" title="Permalink to this headline">¶</a></h2>
<div class="figure align-center">
<img alt="_images/sen_class.png" src="_images/sen_class.png" />
</div>
<div class="section" id="id1">
<h3><span class="section-number">14.4.1. </span>Introduction<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Sentiment_analysis">Sentiment analysis</a> (sometimes known as opinion mining or emotion AI) refers to the use of natural language processing, text analysis, computational linguistics, and biometrics to systematically identify, extract, quantify, and study affective states and subjective information. Sentiment analysis is widely applied to voice of the customer materials such as reviews and survey responses, online and social media, and healthcare materials for applications that range from marketing to customer service to clinical medicine.</p>
<p>Generally speaking, sentiment analysis aims to <strong>determine the attitude</strong> of a speaker, writer, or other subject with respect to some topic or the overall contextual polarity or emotional reaction to a document, interaction, or event. The attitude may be a judgment or evaluation (see appraisal theory), affective state (that is to say, the emotional state of the author or speaker), or the intended emotional communication (that is to say, the emotional effect intended by the author or interlocutor).</p>
<p>Sentiment analysis in business, also known as opinion mining is a process of identifying and cataloging a piece of text according to the tone conveyed by it. It has broad application:</p>
<ul class="simple">
<li><p>Sentiment Analysis in Business Intelligence Build up</p></li>
<li><p>Sentiment Analysis in Business for Competitive Advantage</p></li>
<li><p>Enhancing the Customer Experience through Sentiment Analysis in Business</p></li>
</ul>
</div>
<div class="section" id="pipeline">
<h3><span class="section-number">14.4.2. </span>Pipeline<a class="headerlink" href="#pipeline" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id6">
<span id="fig-sa-pipeline"></span><img alt="_images/sentiment_analysis_pipeline.png" src="_images/sentiment_analysis_pipeline.png" />
<p class="caption"><span class="caption-text">Sentiment Analysis Pipeline</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="id2">
<h3><span class="section-number">14.4.3. </span>Demo<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Set up spark context and SparkSession</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span> \
    <span class="o">.</span><span class="n">builder</span> \
    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;Python Spark Sentiment Analysis example&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">&quot;spark.some.config.option&quot;</span><span class="p">,</span> <span class="s2">&quot;some-value&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Load dataset</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;com.databricks.spark.csv&#39;</span><span class="p">)</span><span class="o">.</span>\
                               <span class="n">options</span><span class="p">(</span><span class="n">header</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> \
                               <span class="n">inferschema</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">)</span><span class="o">.</span>\
            <span class="n">load</span><span class="p">(</span><span class="s2">&quot;../data/newtwitter.csv&quot;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+----------+-------+</span>
<span class="o">|</span>                <span class="n">text</span><span class="o">|</span>        <span class="nb">id</span><span class="o">|</span><span class="n">pubdate</span><span class="o">|</span>
<span class="o">+--------------------+----------+-------+</span>
<span class="o">|</span><span class="mi">10</span> <span class="n">Things</span> <span class="n">Missing</span><span class="o">...|</span><span class="mi">2602860537</span><span class="o">|</span>  <span class="mi">18536</span><span class="o">|</span>
<span class="o">|</span><span class="n">RT</span> <span class="nd">@_NATURALBWINN</span><span class="o">...|</span><span class="mi">2602850443</span><span class="o">|</span>  <span class="mi">18536</span><span class="o">|</span>
<span class="o">|</span><span class="n">RT</span> <span class="nd">@HBO24</span> <span class="n">yo</span> <span class="n">the</span> <span class="o">...|</span><span class="mi">2602761852</span><span class="o">|</span>  <span class="mi">18535</span><span class="o">|</span>
<span class="o">|</span><span class="n">Aaaaaaaand</span> <span class="n">I</span> <span class="n">have</span><span class="o">...|</span><span class="mi">2602738438</span><span class="o">|</span>  <span class="mi">18535</span><span class="o">|</span>
<span class="o">|</span><span class="n">can</span> <span class="n">I</span> <span class="n">please</span> <span class="n">have</span><span class="o">...|</span><span class="mi">2602684185</span><span class="o">|</span>  <span class="mi">18535</span><span class="o">|</span>
<span class="o">+--------------------+----------+-------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Text Preprocessing</p></li>
</ol>
<ul class="simple">
<li><p>remove non ASCII characters</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">udf</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StringType</span>

<span class="kn">from</span> <span class="nn">nltk.stem.wordnet</span> <span class="kn">import</span> <span class="n">WordNetLemmatizer</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span> <span class="nn">nltk</span> <span class="kn">import</span> <span class="n">pos_tag</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1"># remove non ASCII characters</span>
<span class="k">def</span> <span class="nf">strip_non_ascii</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Returns the string without non ASCII characters&#39;&#39;&#39;</span>
    <span class="n">stripped</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data_str</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">127</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stripped</span><span class="p">)</span>
<span class="c1"># setup pyspark udf function</span>
<span class="n">strip_non_ascii_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">strip_non_ascii</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
</pre></div>
</div>
<p>check:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;text_non_asci&#39;</span><span class="p">,</span><span class="n">strip_non_ascii_udf</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]))</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>ouput:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+----------+-------+--------------------+</span>
<span class="o">|</span>                <span class="n">text</span><span class="o">|</span>        <span class="nb">id</span><span class="o">|</span><span class="n">pubdate</span><span class="o">|</span>       <span class="n">text_non_asci</span><span class="o">|</span>
<span class="o">+--------------------+----------+-------+--------------------+</span>
<span class="o">|</span><span class="mi">10</span> <span class="n">Things</span> <span class="n">Missing</span><span class="o">...|</span><span class="mi">2602860537</span><span class="o">|</span>  <span class="mi">18536</span><span class="o">|</span><span class="mi">10</span> <span class="n">Things</span> <span class="n">Missing</span><span class="o">...|</span>
<span class="o">|</span><span class="n">RT</span> <span class="nd">@_NATURALBWINN</span><span class="o">...|</span><span class="mi">2602850443</span><span class="o">|</span>  <span class="mi">18536</span><span class="o">|</span><span class="n">RT</span> <span class="nd">@_NATURALBWINN</span><span class="o">...|</span>
<span class="o">|</span><span class="n">RT</span> <span class="nd">@HBO24</span> <span class="n">yo</span> <span class="n">the</span> <span class="o">...|</span><span class="mi">2602761852</span><span class="o">|</span>  <span class="mi">18535</span><span class="o">|</span><span class="n">RT</span> <span class="nd">@HBO24</span> <span class="n">yo</span> <span class="n">the</span> <span class="o">...|</span>
<span class="o">|</span><span class="n">Aaaaaaaand</span> <span class="n">I</span> <span class="n">have</span><span class="o">...|</span><span class="mi">2602738438</span><span class="o">|</span>  <span class="mi">18535</span><span class="o">|</span><span class="n">Aaaaaaaand</span> <span class="n">I</span> <span class="n">have</span><span class="o">...|</span>
<span class="o">|</span><span class="n">can</span> <span class="n">I</span> <span class="n">please</span> <span class="n">have</span><span class="o">...|</span><span class="mi">2602684185</span><span class="o">|</span>  <span class="mi">18535</span><span class="o">|</span><span class="n">can</span> <span class="n">I</span> <span class="n">please</span> <span class="n">have</span><span class="o">...|</span>
<span class="o">+--------------------+----------+-------+--------------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<ul class="simple">
<li><p>fixed abbreviation</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># fixed abbreviation</span>
<span class="k">def</span> <span class="nf">fix_abbreviation</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">data_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bthats\b&#39;</span><span class="p">,</span> <span class="s1">&#39;that is&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bive\b&#39;</span><span class="p">,</span> <span class="s1">&#39;i have&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bim\b&#39;</span><span class="p">,</span> <span class="s1">&#39;i am&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bya\b&#39;</span><span class="p">,</span> <span class="s1">&#39;yeah&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bcant\b&#39;</span><span class="p">,</span> <span class="s1">&#39;can not&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bdont\b&#39;</span><span class="p">,</span> <span class="s1">&#39;do not&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bwont\b&#39;</span><span class="p">,</span> <span class="s1">&#39;will not&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bid\b&#39;</span><span class="p">,</span> <span class="s1">&#39;i would&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;wtf&#39;</span><span class="p">,</span> <span class="s1">&#39;what the fuck&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bwth\b&#39;</span><span class="p">,</span> <span class="s1">&#39;what the hell&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\br\b&#39;</span><span class="p">,</span> <span class="s1">&#39;are&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bu\b&#39;</span><span class="p">,</span> <span class="s1">&#39;you&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bk\b&#39;</span><span class="p">,</span> <span class="s1">&#39;OK&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bsux\b&#39;</span><span class="p">,</span> <span class="s1">&#39;sucks&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bno+\b&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bcoo+\b&#39;</span><span class="p">,</span> <span class="s1">&#39;cool&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;rt\b&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">data_str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data_str</span>

<span class="n">fix_abbreviation_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">fix_abbreviation</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
</pre></div>
</div>
<dl>
<dt>check:</dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;fixed_abbrev&#39;</span><span class="p">,</span><span class="n">fix_abbreviation_udf</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;text_non_asci&#39;</span><span class="p">]))</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p>ouput:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+----------+-------+--------------------+--------------------+</span>
<span class="o">|</span>                <span class="n">text</span><span class="o">|</span>        <span class="nb">id</span><span class="o">|</span><span class="n">pubdate</span><span class="o">|</span>       <span class="n">text_non_asci</span><span class="o">|</span>        <span class="n">fixed_abbrev</span><span class="o">|</span>
<span class="o">+--------------------+----------+-------+--------------------+--------------------+</span>
<span class="o">|</span><span class="mi">10</span> <span class="n">Things</span> <span class="n">Missing</span><span class="o">...|</span><span class="mi">2602860537</span><span class="o">|</span>  <span class="mi">18536</span><span class="o">|</span><span class="mi">10</span> <span class="n">Things</span> <span class="n">Missing</span><span class="o">...|</span><span class="mi">10</span> <span class="n">things</span> <span class="n">missing</span><span class="o">...|</span>
<span class="o">|</span><span class="n">RT</span> <span class="nd">@_NATURALBWINN</span><span class="o">...|</span><span class="mi">2602850443</span><span class="o">|</span>  <span class="mi">18536</span><span class="o">|</span><span class="n">RT</span> <span class="nd">@_NATURALBWINN</span><span class="o">...|</span><span class="nd">@_naturalbwinner</span> <span class="o">...|</span>
<span class="o">|</span><span class="n">RT</span> <span class="nd">@HBO24</span> <span class="n">yo</span> <span class="n">the</span> <span class="o">...|</span><span class="mi">2602761852</span><span class="o">|</span>  <span class="mi">18535</span><span class="o">|</span><span class="n">RT</span> <span class="nd">@HBO24</span> <span class="n">yo</span> <span class="n">the</span> <span class="o">...|</span><span class="nd">@hbo24</span> <span class="n">yo</span> <span class="n">the</span> <span class="c1">#ne...|</span>
<span class="o">|</span><span class="n">Aaaaaaaand</span> <span class="n">I</span> <span class="n">have</span><span class="o">...|</span><span class="mi">2602738438</span><span class="o">|</span>  <span class="mi">18535</span><span class="o">|</span><span class="n">Aaaaaaaand</span> <span class="n">I</span> <span class="n">have</span><span class="o">...|</span><span class="n">aaaaaaaand</span> <span class="n">i</span> <span class="n">have</span><span class="o">...|</span>
<span class="o">|</span><span class="n">can</span> <span class="n">I</span> <span class="n">please</span> <span class="n">have</span><span class="o">...|</span><span class="mi">2602684185</span><span class="o">|</span>  <span class="mi">18535</span><span class="o">|</span><span class="n">can</span> <span class="n">I</span> <span class="n">please</span> <span class="n">have</span><span class="o">...|</span><span class="n">can</span> <span class="n">i</span> <span class="n">please</span> <span class="n">have</span><span class="o">...|</span>
<span class="o">+--------------------+----------+-------+--------------------+--------------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<ul class="simple">
<li><p>remove irrelevant features</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">remove_features</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="c1"># compile regex</span>
    <span class="n">url_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;https?://(www.)?\w+\.\w+(/\w+)*/?&#39;</span><span class="p">)</span>
    <span class="n">punc_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">))</span>
    <span class="n">num_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(</span><span class="se">\\</span><span class="s1">d+)&#39;</span><span class="p">)</span>
    <span class="n">mention_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;@(\w+)&#39;</span><span class="p">)</span>
    <span class="n">alpha_num_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^[a-z0-9_.]+$&quot;</span><span class="p">)</span>
    <span class="c1"># convert to lowercase</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">data_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c1"># remove hyperlinks</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">url_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="c1"># remove @mentions</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">mention_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="c1"># remove puncuation</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">punc_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="c1"># remove numeric &#39;words&#39;</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">num_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="c1"># remove non a-z 0-9 characters and words shorter than 1 characters</span>
    <span class="n">list_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cleaned_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">data_str</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">list_pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alpha_num_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">word</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alpha_num_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">cleaned_str</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">word</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
        <span class="n">list_pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># remove unwanted space, *.split() will automatically split on</span>
    <span class="c1"># whitespace and discard duplicates, the &quot; &quot;.join() joins the</span>
    <span class="c1"># resulting list into one string.</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cleaned_str</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
<span class="c1"># setup pyspark udf function</span>
<span class="n">remove_features_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">remove_features</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
</pre></div>
</div>
<dl>
<dt>check:</dt><dd><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;removed&#39;</span><span class="p">,</span><span class="n">remove_features_udf</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;fixed_abbrev&#39;</span><span class="p">]))</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p>ouput:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+----------+-------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span>                <span class="n">text</span><span class="o">|</span>        <span class="nb">id</span><span class="o">|</span><span class="n">pubdate</span><span class="o">|</span>       <span class="n">text_non_asci</span><span class="o">|</span>        <span class="n">fixed_abbrev</span><span class="o">|</span>             <span class="n">removed</span><span class="o">|</span>
<span class="o">+--------------------+----------+-------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span><span class="mi">10</span> <span class="n">Things</span> <span class="n">Missing</span><span class="o">...|</span><span class="mi">2602860537</span><span class="o">|</span>  <span class="mi">18536</span><span class="o">|</span><span class="mi">10</span> <span class="n">Things</span> <span class="n">Missing</span><span class="o">...|</span><span class="mi">10</span> <span class="n">things</span> <span class="n">missing</span><span class="o">...|</span><span class="n">things</span> <span class="n">missing</span> <span class="ow">in</span><span class="o">...|</span>
<span class="o">|</span><span class="n">RT</span> <span class="nd">@_NATURALBWINN</span><span class="o">...|</span><span class="mi">2602850443</span><span class="o">|</span>  <span class="mi">18536</span><span class="o">|</span><span class="n">RT</span> <span class="nd">@_NATURALBWINN</span><span class="o">...|</span><span class="nd">@_naturalbwinner</span> <span class="o">...|</span><span class="n">oh</span> <span class="ow">and</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">lik</span><span class="o">...|</span>
<span class="o">|</span><span class="n">RT</span> <span class="nd">@HBO24</span> <span class="n">yo</span> <span class="n">the</span> <span class="o">...|</span><span class="mi">2602761852</span><span class="o">|</span>  <span class="mi">18535</span><span class="o">|</span><span class="n">RT</span> <span class="nd">@HBO24</span> <span class="n">yo</span> <span class="n">the</span> <span class="o">...|</span><span class="nd">@hbo24</span> <span class="n">yo</span> <span class="n">the</span> <span class="c1">#ne...|yo the newtwitter...|</span>
<span class="o">|</span><span class="n">Aaaaaaaand</span> <span class="n">I</span> <span class="n">have</span><span class="o">...|</span><span class="mi">2602738438</span><span class="o">|</span>  <span class="mi">18535</span><span class="o">|</span><span class="n">Aaaaaaaand</span> <span class="n">I</span> <span class="n">have</span><span class="o">...|</span><span class="n">aaaaaaaand</span> <span class="n">i</span> <span class="n">have</span><span class="o">...|</span><span class="n">aaaaaaaand</span> <span class="n">have</span> <span class="n">t</span><span class="o">...|</span>
<span class="o">|</span><span class="n">can</span> <span class="n">I</span> <span class="n">please</span> <span class="n">have</span><span class="o">...|</span><span class="mi">2602684185</span><span class="o">|</span>  <span class="mi">18535</span><span class="o">|</span><span class="n">can</span> <span class="n">I</span> <span class="n">please</span> <span class="n">have</span><span class="o">...|</span><span class="n">can</span> <span class="n">i</span> <span class="n">please</span> <span class="n">have</span><span class="o">...|</span><span class="n">can</span> <span class="n">please</span> <span class="n">have</span> <span class="n">t</span><span class="o">...|</span>
<span class="o">+--------------------+----------+-------+--------------------+--------------------+--------------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Sentiment Analysis  main function</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">FloatType</span>

<span class="kn">from</span> <span class="nn">textblob</span> <span class="kn">import</span> <span class="n">TextBlob</span>

<span class="k">def</span> <span class="nf">sentiment_analysis</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">TextBlob</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">sentiment</span><span class="o">.</span><span class="n">polarity</span>

<span class="n">sentiment_analysis_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">sentiment_analysis</span> <span class="p">,</span> <span class="n">FloatType</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>  <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;sentiment_score&quot;</span><span class="p">,</span> <span class="n">sentiment_analysis_udf</span><span class="p">(</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;removed&#39;</span><span class="p">]</span> <span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Sentiment score</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+---------------+</span>
<span class="o">|</span>             <span class="n">removed</span><span class="o">|</span><span class="n">sentiment_score</span><span class="o">|</span>
<span class="o">+--------------------+---------------+</span>
<span class="o">|</span><span class="n">things</span> <span class="n">missing</span> <span class="ow">in</span><span class="o">...|</span>    <span class="o">-</span><span class="mf">0.03181818</span><span class="o">|</span>
<span class="o">|</span><span class="n">oh</span> <span class="ow">and</span> <span class="n">do</span> <span class="ow">not</span> <span class="n">lik</span><span class="o">...|</span>    <span class="o">-</span><span class="mf">0.03181818</span><span class="o">|</span>
<span class="o">|</span><span class="n">yo</span> <span class="n">the</span> <span class="n">newtwitter</span><span class="o">...|</span>      <span class="mf">0.3181818</span><span class="o">|</span>
<span class="o">|</span><span class="n">aaaaaaaand</span> <span class="n">have</span> <span class="n">t</span><span class="o">...|</span>     <span class="mf">0.11818182</span><span class="o">|</span>
<span class="o">|</span><span class="n">can</span> <span class="n">please</span> <span class="n">have</span> <span class="n">t</span><span class="o">...|</span>     <span class="mf">0.13636364</span><span class="o">|</span>
<span class="o">+--------------------+---------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Words frequency</p></li>
</ul>
<div class="figure align-center">
<img alt="_images/sen_word_freq.png" src="_images/sen_word_freq.png" />
</div>
<ul class="simple">
<li><p>Sentiment Classification</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">condition</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;positive&quot;</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;negative&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;neutral&quot;</span>
    <span class="k">return</span> <span class="n">label</span>

<span class="n">sentiment_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">condition</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">StringType</span><span class="p">())</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Output</p></li>
</ol>
<ul class="simple">
<li><p>Sentiment Class</p></li>
</ul>
<div class="figure align-center">
<img alt="_images/sen_class.png" src="_images/sen_class.png" />
</div>
<ul class="simple">
<li><p>Top tweets from each sentiment class</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+---------------+---------+</span>
<span class="o">|</span>                <span class="n">text</span><span class="o">|</span><span class="n">sentiment_score</span><span class="o">|</span><span class="n">sentiment</span><span class="o">|</span>
<span class="o">+--------------------+---------------+---------+</span>
<span class="o">|</span><span class="ow">and</span> <span class="n">this</span> <span class="c1">#newtwit...|            1.0| positive|</span>
<span class="o">|</span><span class="s2">&quot;RT @SarahsJokes:...|            1.0| positive|</span>
<span class="o">|</span><span class="c1">#newtwitter using...|            1.0| positive|</span>
<span class="o">|</span><span class="n">The</span> <span class="c1">#NewTwitter h...|            1.0| positive|</span>
<span class="o">|</span><span class="n">You</span> <span class="n">can</span> <span class="n">now</span> <span class="n">undo</span> <span class="o">...|</span>            <span class="mf">1.0</span><span class="o">|</span> <span class="n">positive</span><span class="o">|</span>
<span class="o">+--------------------+---------------+---------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+---------------+---------+</span>
<span class="o">|</span>                <span class="n">text</span><span class="o">|</span><span class="n">sentiment_score</span><span class="o">|</span><span class="n">sentiment</span><span class="o">|</span>
<span class="o">+--------------------+---------------+---------+</span>
<span class="o">|</span><span class="n">Lists</span> <span class="n">on</span> <span class="c1">#NewTwit...|           -0.1|  neutral|</span>
<span class="o">|</span><span class="n">Too</span> <span class="n">bad</span> <span class="n">most</span> <span class="n">of</span> <span class="n">m</span><span class="o">...|</span>           <span class="o">-</span><span class="mf">0.1</span><span class="o">|</span>  <span class="n">neutral</span><span class="o">|</span>
<span class="o">|</span><span class="n">the</span> <span class="c1">#newtwitter i...|           -0.1|  neutral|</span>
<span class="o">|</span><span class="n">Looks</span> <span class="n">like</span> <span class="n">our</span> <span class="n">re</span><span class="o">...|</span>           <span class="o">-</span><span class="mf">0.1</span><span class="o">|</span>  <span class="n">neutral</span><span class="o">|</span>
<span class="o">|</span><span class="n">i</span> <span class="n">switched</span> <span class="n">to</span> <span class="n">the</span><span class="o">...|</span>           <span class="o">-</span><span class="mf">0.1</span><span class="o">|</span>  <span class="n">neutral</span><span class="o">|</span>
<span class="o">+--------------------+---------------+---------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+---------------+---------+</span>
<span class="o">|</span>                <span class="n">text</span><span class="o">|</span><span class="n">sentiment_score</span><span class="o">|</span><span class="n">sentiment</span><span class="o">|</span>
<span class="o">+--------------------+---------------+---------+</span>
<span class="o">|</span><span class="n">oh</span><span class="o">.</span> <span class="c1">#newtwitter i...|           -1.0| negative|</span>
<span class="o">|</span><span class="n">RT</span> <span class="nd">@chqwn</span><span class="p">:</span> <span class="c1">#NewTw...|           -1.0| negative|</span>
<span class="o">|</span><span class="n">Copy</span> <span class="n">that</span> <span class="o">-</span> <span class="n">its</span> <span class="n">W</span><span class="o">...|</span>           <span class="o">-</span><span class="mf">1.0</span><span class="o">|</span> <span class="n">negative</span><span class="o">|</span>
<span class="o">|</span><span class="n">RT</span> <span class="nd">@chqwn</span><span class="p">:</span> <span class="c1">#NewTw...|           -1.0| negative|</span>
<span class="o">|</span><span class="c1">#NewTwitter has t...|           -1.0| negative|</span>
<span class="o">+--------------------+---------------+---------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="n-grams-and-correlations">
<h2><span class="section-number">14.5. </span>N-grams and Correlations<a class="headerlink" href="#n-grams-and-correlations" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="topic-model-latent-dirichlet-allocation">
<span id="topicmodel"></span><h2><span class="section-number">14.6. </span>Topic Model: Latent Dirichlet Allocation<a class="headerlink" href="#topic-model-latent-dirichlet-allocation" title="Permalink to this headline">¶</a></h2>
<div class="figure align-center">
<img alt="_images/topic_time.png" src="_images/topic_time.png" />
</div>
<div class="section" id="id3">
<h3><span class="section-number">14.6.1. </span>Introduction<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>In text mining, a topic model is a unsupervised model for discovering the abstract “topics” that occur in a collection of documents.</p>
<p>Latent Dirichlet Allocation (LDA) is a mathematical method for estimating both of these at the same time: finding the mixture of words that is associated with each topic, while also determining the mixture of topics that describes each document.</p>
</div>
<div class="section" id="id4">
<h3><span class="section-number">14.6.2. </span>Demo<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Load data</p></li>
</ol>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rawdata</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;../data/airlines.csv&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rawdata</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+-----+---------------+---------+--------+------+--------+-----+-----------+--------------------+</span>
<span class="o">|</span>   <span class="nb">id</span><span class="o">|</span>        <span class="n">airline</span><span class="o">|</span>     <span class="n">date</span><span class="o">|</span><span class="n">location</span><span class="o">|</span><span class="n">rating</span><span class="o">|</span>   <span class="n">cabin</span><span class="o">|</span><span class="n">value</span><span class="o">|</span><span class="n">recommended</span><span class="o">|</span>              <span class="n">review</span><span class="o">|</span>
<span class="o">+-----+---------------+---------+--------+------+--------+-----+-----------+--------------------+</span>
<span class="o">|</span><span class="mi">10001</span><span class="o">|</span><span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">21</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">14</span><span class="o">|</span><span class="n">Thailand</span><span class="o">|</span>     <span class="mi">7</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">4</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">Flew</span> <span class="n">Mar</span> <span class="mi">30</span> <span class="n">NRT</span> <span class="n">t</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10002</span><span class="o">|</span><span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">19</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">14</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>     <span class="mi">0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">2</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="mi">2463</span> <span class="n">leavi</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10003</span><span class="o">|</span><span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">18</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">14</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>     <span class="mi">0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">1</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Delta</span> <span class="n">Website</span> <span class="n">fro</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10004</span><span class="o">|</span><span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">17</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">14</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>     <span class="mi">9</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">4</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="s2">&quot;I just returned ...|</span>
<span class="o">|</span><span class="mi">10005</span><span class="o">|</span><span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">17</span><span class="o">-</span><span class="n">Jun</span><span class="o">-</span><span class="mi">14</span><span class="o">|</span> <span class="n">Ecuador</span><span class="o">|</span>     <span class="mi">7</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">3</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="s2">&quot;Round-trip fligh...|</span>
<span class="o">+-----+---------------+---------+--------+------+--------+-----+-----------+--------------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple">
<li><p>Text preprocessing</p></li>
</ol>
<p>I will use the following raw column names to keep my table concise:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">raw_cols</span> <span class="o">=</span>  <span class="n">rawdata</span><span class="o">.</span><span class="n">columns</span>
<span class="n">raw_cols</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;airline&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">,</span> <span class="s1">&#39;rating&#39;</span><span class="p">,</span> <span class="s1">&#39;cabin&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;recommended&#39;</span><span class="p">,</span> <span class="s1">&#39;review&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rawdata</span> <span class="o">=</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">dropDuplicates</span><span class="p">([</span><span class="s1">&#39;review&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">udf</span><span class="p">,</span> <span class="n">col</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">,</span> <span class="n">DateType</span>

<span class="kn">from</span> <span class="nn">nltk.stem.wordnet</span> <span class="kn">import</span> <span class="n">WordNetLemmatizer</span>
<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>
<span class="kn">from</span> <span class="nn">nltk</span> <span class="kn">import</span> <span class="n">pos_tag</span>
<span class="kn">import</span> <span class="nn">langid</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">re</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>remove non ASCII characters</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove non ASCII characters</span>
<span class="k">def</span> <span class="nf">strip_non_ascii</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Returns the string without non ASCII characters&#39;&#39;&#39;</span>
    <span class="n">stripped</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">data_str</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">127</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stripped</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>check it blank line or not</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># check to see if a row only contains whitespace</span>
<span class="k">def</span> <span class="nf">check_blanks</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="n">is_blank</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_str</span><span class="o">.</span><span class="n">isspace</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">is_blank</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>check the language (a little bit slow, I skited this step)</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># check the language (only apply to english)</span>
<span class="k">def</span> <span class="nf">check_lang</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">langid.langid</span> <span class="kn">import</span> <span class="n">LanguageIdentifier</span><span class="p">,</span> <span class="n">model</span>
    <span class="n">identifier</span> <span class="o">=</span> <span class="n">LanguageIdentifier</span><span class="o">.</span><span class="n">from_modelstring</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">norm_probs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">predict_lang</span> <span class="o">=</span> <span class="n">identifier</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">data_str</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">predict_lang</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="o">.</span><span class="mi">9</span><span class="p">:</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">predict_lang</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">predict_lang</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">language</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>fixed abbreviation</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># fixed abbreviation</span>
<span class="k">def</span> <span class="nf">fix_abbreviation</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">data_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bthats\b&#39;</span><span class="p">,</span> <span class="s1">&#39;that is&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bive\b&#39;</span><span class="p">,</span> <span class="s1">&#39;i have&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bim\b&#39;</span><span class="p">,</span> <span class="s1">&#39;i am&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bya\b&#39;</span><span class="p">,</span> <span class="s1">&#39;yeah&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bcant\b&#39;</span><span class="p">,</span> <span class="s1">&#39;can not&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bdont\b&#39;</span><span class="p">,</span> <span class="s1">&#39;do not&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bwont\b&#39;</span><span class="p">,</span> <span class="s1">&#39;will not&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bid\b&#39;</span><span class="p">,</span> <span class="s1">&#39;i would&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;wtf&#39;</span><span class="p">,</span> <span class="s1">&#39;what the fuck&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bwth\b&#39;</span><span class="p">,</span> <span class="s1">&#39;what the hell&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\br\b&#39;</span><span class="p">,</span> <span class="s1">&#39;are&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bu\b&#39;</span><span class="p">,</span> <span class="s1">&#39;you&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bk\b&#39;</span><span class="p">,</span> <span class="s1">&#39;OK&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bsux\b&#39;</span><span class="p">,</span> <span class="s1">&#39;sucks&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bno+\b&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\bcoo+\b&#39;</span><span class="p">,</span> <span class="s1">&#39;cool&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;rt\b&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">data_str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data_str</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>remove irrelevant features</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># remove irrelevant features</span>
<span class="k">def</span> <span class="nf">remove_features</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="c1"># compile regex</span>
    <span class="n">url_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;https?://(www.)?\w+\.\w+(/\w+)*/?&#39;</span><span class="p">)</span>
    <span class="n">punc_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">punctuation</span><span class="p">))</span>
    <span class="n">num_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(</span><span class="se">\\</span><span class="s1">d+)&#39;</span><span class="p">)</span>
    <span class="n">mention_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;@(\w+)&#39;</span><span class="p">)</span>
    <span class="n">alpha_num_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;^[a-z0-9_.]+$&quot;</span><span class="p">)</span>
    <span class="c1"># convert to lowercase</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">data_str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="c1"># remove hyperlinks</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">url_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="c1"># remove @mentions</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">mention_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="c1"># remove puncuation</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">punc_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="c1"># remove numeric &#39;words&#39;</span>
    <span class="n">data_str</span> <span class="o">=</span> <span class="n">num_re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">data_str</span><span class="p">)</span>
    <span class="c1"># remove non a-z 0-9 characters and words shorter than 1 characters</span>
    <span class="n">list_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cleaned_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">data_str</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">list_pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alpha_num_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">word</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">alpha_num_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">cleaned_str</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">word</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
        <span class="n">list_pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="c1"># remove unwanted space, *.split() will automatically split on</span>
    <span class="c1"># whitespace and discard duplicates, the &quot; &quot;.join() joins the</span>
    <span class="c1"># resulting list into one string.</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cleaned_str</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>removes stop words</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># removes stop words</span>
<span class="k">def</span> <span class="nf">remove_stops</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="c1"># expects a string</span>
    <span class="n">stops</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s2">&quot;english&quot;</span><span class="p">))</span>
    <span class="n">list_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cleaned_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">data_str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stops</span><span class="p">:</span>
            <span class="c1"># rebuild cleaned_str</span>
            <span class="k">if</span> <span class="n">list_pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">word</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">cleaned_str</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">word</span>
            <span class="n">list_pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">cleaned_str</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Part-of-Speech Tagging</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Part-of-Speech Tagging</span>
<span class="k">def</span> <span class="nf">tag_and_remove</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="n">cleaned_str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
    <span class="c1"># noun tags</span>
    <span class="n">nn_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NN&#39;</span><span class="p">,</span> <span class="s1">&#39;NNP&#39;</span><span class="p">,</span> <span class="s1">&#39;NNP&#39;</span><span class="p">,</span> <span class="s1">&#39;NNPS&#39;</span><span class="p">,</span> <span class="s1">&#39;NNS&#39;</span><span class="p">]</span>
    <span class="c1"># adjectives</span>
    <span class="n">jj_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;JJ&#39;</span><span class="p">,</span> <span class="s1">&#39;JJR&#39;</span><span class="p">,</span> <span class="s1">&#39;JJS&#39;</span><span class="p">]</span>
    <span class="c1"># verbs</span>
    <span class="n">vb_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;VB&#39;</span><span class="p">,</span> <span class="s1">&#39;VBD&#39;</span><span class="p">,</span> <span class="s1">&#39;VBG&#39;</span><span class="p">,</span> <span class="s1">&#39;VBN&#39;</span><span class="p">,</span> <span class="s1">&#39;VBP&#39;</span><span class="p">,</span> <span class="s1">&#39;VBZ&#39;</span><span class="p">]</span>
    <span class="n">nltk_tags</span> <span class="o">=</span> <span class="n">nn_tags</span> <span class="o">+</span> <span class="n">jj_tags</span> <span class="o">+</span> <span class="n">vb_tags</span>

    <span class="c1"># break string into &#39;words&#39;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">data_str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

    <span class="c1"># tag the text and keep only those with the right tags</span>
    <span class="n">tagged_text</span> <span class="o">=</span> <span class="n">pos_tag</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tagged_word</span> <span class="ow">in</span> <span class="n">tagged_text</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tagged_word</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">nltk_tags</span><span class="p">:</span>
            <span class="n">cleaned_str</span> <span class="o">+=</span> <span class="n">tagged_word</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>

    <span class="k">return</span> <span class="n">cleaned_str</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>lemmatization</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># lemmatization</span>
<span class="k">def</span> <span class="nf">lemmatize</span><span class="p">(</span><span class="n">data_str</span><span class="p">):</span>
    <span class="c1"># expects a string</span>
    <span class="n">list_pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">cleaned_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">lmtzr</span> <span class="o">=</span> <span class="n">WordNetLemmatizer</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">data_str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">tagged_words</span> <span class="o">=</span> <span class="n">pos_tag</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">tagged_words</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;v&#39;</span> <span class="ow">in</span> <span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">lemma</span> <span class="o">=</span> <span class="n">lmtzr</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="o">=</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lemma</span> <span class="o">=</span> <span class="n">lmtzr</span><span class="o">.</span><span class="n">lemmatize</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="o">=</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">list_pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">lemma</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cleaned_str</span> <span class="o">=</span> <span class="n">cleaned_str</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">lemma</span>
        <span class="n">list_pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">cleaned_str</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>setup pyspark udf function</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># setup pyspark udf function</span>
<span class="n">strip_non_ascii_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">strip_non_ascii</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">check_blanks_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">check_blanks</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">check_lang_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">check_lang</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">fix_abbreviation_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">fix_abbreviation</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">remove_stops_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">remove_stops</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">remove_features_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">remove_features</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">tag_and_remove_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">tag_and_remove</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
<span class="n">lemmatize_udf</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="n">lemmatize</span><span class="p">,</span> <span class="n">StringType</span><span class="p">())</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple">
<li><p>Text processing</p></li>
</ol>
<ul class="simple">
<li><p>correct the data schema</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rawdata</span> <span class="o">=</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;rating&#39;</span><span class="p">,</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">rating</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rawdata</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">root</span>
<span class="o">|--</span> <span class="nb">id</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
<span class="o">|--</span> <span class="n">airline</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
<span class="o">|--</span> <span class="n">date</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
<span class="o">|--</span> <span class="n">location</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
<span class="o">|--</span> <span class="n">rating</span><span class="p">:</span> <span class="nb">float</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
<span class="o">|--</span> <span class="n">cabin</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
<span class="o">|--</span> <span class="n">value</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
<span class="o">|--</span> <span class="n">recommended</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
<span class="o">|--</span> <span class="n">review</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span>

<span class="c1"># https://docs.python.org/2/library/datetime.html#strftime-and-strptime-behavior</span>
<span class="c1"># 21-Jun-14 &lt;----&gt; %d-%b-%y</span>
<span class="n">to_date</span> <span class="o">=</span>  <span class="n">udf</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%b-%y&#39;</span><span class="p">),</span> <span class="n">DateType</span><span class="p">())</span>

<span class="n">rawdata</span> <span class="o">=</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">to_date</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rawdata</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">root</span>
 <span class="o">|--</span> <span class="nb">id</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
 <span class="o">|--</span> <span class="n">airline</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
 <span class="o">|--</span> <span class="n">date</span><span class="p">:</span> <span class="n">date</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
 <span class="o">|--</span> <span class="n">location</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
 <span class="o">|--</span> <span class="n">rating</span><span class="p">:</span> <span class="nb">float</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
 <span class="o">|--</span> <span class="n">cabin</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
 <span class="o">|--</span> <span class="n">value</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
 <span class="o">|--</span> <span class="n">recommended</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
 <span class="o">|--</span> <span class="n">review</span><span class="p">:</span> <span class="n">string</span> <span class="p">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rawdata</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+</span>
<span class="o">|</span>   <span class="nb">id</span><span class="o">|</span>           <span class="n">airline</span><span class="o">|</span>      <span class="n">date</span><span class="o">|</span><span class="n">location</span><span class="o">|</span><span class="n">rating</span><span class="o">|</span>   <span class="n">cabin</span><span class="o">|</span><span class="n">value</span><span class="o">|</span><span class="n">recommended</span><span class="o">|</span>              <span class="n">review</span><span class="o">|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+</span>
<span class="o">|</span><span class="mi">10551</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">2</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="mi">3246</span> <span class="kn">from</span> <span class="nn">...</span><span class="o">|</span>
<span class="o">|</span><span class="mi">10298</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span>      <span class="n">UK</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">0</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="kn">from</span> <span class="nn">Manch...</span><span class="o">|</span>
<span class="o">|</span><span class="mi">10564</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">5</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">I</span><span class="s1">&#39;m Executive Pla...|</span>
<span class="o">|</span><span class="mi">10134</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">8.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">4</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">MSP</span><span class="o">-</span><span class="n">JFK</span><span class="o">-</span><span class="n">MXP</span> <span class="ow">and</span> <span class="n">r</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10912</span><span class="o">|</span>   <span class="n">United</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">07</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">3.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">1</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Worst</span> <span class="n">airline</span> <span class="n">I</span> <span class="n">h</span><span class="o">...|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rawdata</span> <span class="o">=</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;non_asci&#39;</span><span class="p">,</span> <span class="n">strip_non_ascii_udf</span><span class="p">(</span><span class="n">rawdata</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]))</span>


<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+</span>
<span class="o">|</span>   <span class="nb">id</span><span class="o">|</span>           <span class="n">airline</span><span class="o">|</span>      <span class="n">date</span><span class="o">|</span><span class="n">location</span><span class="o">|</span><span class="n">rating</span><span class="o">|</span>   <span class="n">cabin</span><span class="o">|</span><span class="n">value</span><span class="o">|</span><span class="n">recommended</span><span class="o">|</span>              <span class="n">review</span><span class="o">|</span>            <span class="n">non_asci</span><span class="o">|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+</span>
<span class="o">|</span><span class="mi">10551</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">2</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="mi">3246</span> <span class="kn">from</span> <span class="nn">...</span><span class="o">|</span><span class="n">Flight</span> <span class="mi">3246</span> <span class="kn">from</span> <span class="nn">...</span><span class="o">|</span>
<span class="o">|</span><span class="mi">10298</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span>      <span class="n">UK</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">0</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="kn">from</span> <span class="nn">Manch...</span><span class="o">|</span><span class="n">Flight</span> <span class="kn">from</span> <span class="nn">Manch...</span><span class="o">|</span>
<span class="o">|</span><span class="mi">10564</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">5</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">I</span><span class="s1">&#39;m Executive Pla...|I&#39;</span><span class="n">m</span> <span class="n">Executive</span> <span class="n">Pla</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10134</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">8.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">4</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">MSP</span><span class="o">-</span><span class="n">JFK</span><span class="o">-</span><span class="n">MXP</span> <span class="ow">and</span> <span class="n">r</span><span class="o">...|</span><span class="n">MSP</span><span class="o">-</span><span class="n">JFK</span><span class="o">-</span><span class="n">MXP</span> <span class="ow">and</span> <span class="n">r</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10912</span><span class="o">|</span>   <span class="n">United</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">07</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">3.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">1</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Worst</span> <span class="n">airline</span> <span class="n">I</span> <span class="n">h</span><span class="o">...|</span><span class="n">Worst</span> <span class="n">airline</span> <span class="n">I</span> <span class="n">h</span><span class="o">...|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rawdata</span> <span class="o">=</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">raw_cols</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;non_asci&#39;</span><span class="p">])</span>\
                 <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;fixed_abbrev&#39;</span><span class="p">,</span><span class="n">fix_abbreviation_udf</span><span class="p">(</span><span class="n">rawdata</span><span class="p">[</span><span class="s1">&#39;non_asci&#39;</span><span class="p">]))</span>

<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span>   <span class="nb">id</span><span class="o">|</span>           <span class="n">airline</span><span class="o">|</span>      <span class="n">date</span><span class="o">|</span><span class="n">location</span><span class="o">|</span><span class="n">rating</span><span class="o">|</span>   <span class="n">cabin</span><span class="o">|</span><span class="n">value</span><span class="o">|</span><span class="n">recommended</span><span class="o">|</span>              <span class="n">review</span><span class="o">|</span>            <span class="n">non_asci</span><span class="o">|</span>        <span class="n">fixed_abbrev</span><span class="o">|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span><span class="mi">10551</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">2</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="mi">3246</span> <span class="kn">from</span> <span class="nn">...</span><span class="o">|</span><span class="n">Flight</span> <span class="mi">3246</span> <span class="kn">from</span> <span class="nn">...</span><span class="o">|</span><span class="n">flight</span> <span class="mi">3246</span> <span class="kn">from</span> <span class="nn">...</span><span class="o">|</span>
<span class="o">|</span><span class="mi">10298</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span>      <span class="n">UK</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">0</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="kn">from</span> <span class="nn">Manch...</span><span class="o">|</span><span class="n">Flight</span> <span class="kn">from</span> <span class="nn">Manch...</span><span class="o">|</span><span class="n">flight</span> <span class="kn">from</span> <span class="nn">manch...</span><span class="o">|</span>
<span class="o">|</span><span class="mi">10564</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">5</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">I</span><span class="s1">&#39;m Executive Pla...|I&#39;</span><span class="n">m</span> <span class="n">Executive</span> <span class="n">Pla</span><span class="o">...|</span><span class="n">i</span><span class="s1">&#39;m executive pla...|</span>
<span class="o">|</span><span class="mi">10134</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">8.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">4</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">MSP</span><span class="o">-</span><span class="n">JFK</span><span class="o">-</span><span class="n">MXP</span> <span class="ow">and</span> <span class="n">r</span><span class="o">...|</span><span class="n">MSP</span><span class="o">-</span><span class="n">JFK</span><span class="o">-</span><span class="n">MXP</span> <span class="ow">and</span> <span class="n">r</span><span class="o">...|</span><span class="n">msp</span><span class="o">-</span><span class="n">jfk</span><span class="o">-</span><span class="n">mxp</span> <span class="ow">and</span> <span class="n">r</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10912</span><span class="o">|</span>   <span class="n">United</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">07</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">3.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">1</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Worst</span> <span class="n">airline</span> <span class="n">I</span> <span class="n">h</span><span class="o">...|</span><span class="n">Worst</span> <span class="n">airline</span> <span class="n">I</span> <span class="n">h</span><span class="o">...|</span><span class="n">worst</span> <span class="n">airline</span> <span class="n">i</span> <span class="n">h</span><span class="o">...|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">rawdata</span> <span class="o">=</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">raw_cols</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;fixed_abbrev&#39;</span><span class="p">])</span>\
                  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;stop_text&#39;</span><span class="p">,</span><span class="n">remove_stops_udf</span><span class="p">(</span><span class="n">rawdata</span><span class="p">[</span><span class="s1">&#39;fixed_abbrev&#39;</span><span class="p">]))</span>

<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span>   <span class="nb">id</span><span class="o">|</span>           <span class="n">airline</span><span class="o">|</span>      <span class="n">date</span><span class="o">|</span><span class="n">location</span><span class="o">|</span><span class="n">rating</span><span class="o">|</span>   <span class="n">cabin</span><span class="o">|</span><span class="n">value</span><span class="o">|</span><span class="n">recommended</span><span class="o">|</span>              <span class="n">review</span><span class="o">|</span>        <span class="n">fixed_abbrev</span><span class="o">|</span>           <span class="n">stop_text</span><span class="o">|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span><span class="mi">10551</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">2</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="mi">3246</span> <span class="kn">from</span> <span class="nn">...</span><span class="o">|</span><span class="n">flight</span> <span class="mi">3246</span> <span class="kn">from</span> <span class="nn">...</span><span class="o">|</span><span class="n">flight</span> <span class="mi">3246</span> <span class="n">chica</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10298</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span>      <span class="n">UK</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">0</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="kn">from</span> <span class="nn">Manch...</span><span class="o">|</span><span class="n">flight</span> <span class="kn">from</span> <span class="nn">manch...</span><span class="o">|</span><span class="n">flight</span> <span class="n">manchester</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10564</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">5</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">I</span><span class="s1">&#39;m Executive Pla...|i&#39;</span><span class="n">m</span> <span class="n">executive</span> <span class="n">pla</span><span class="o">...|</span><span class="n">i</span><span class="s1">&#39;m executive pla...|</span>
<span class="o">|</span><span class="mi">10134</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">8.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">4</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">MSP</span><span class="o">-</span><span class="n">JFK</span><span class="o">-</span><span class="n">MXP</span> <span class="ow">and</span> <span class="n">r</span><span class="o">...|</span><span class="n">msp</span><span class="o">-</span><span class="n">jfk</span><span class="o">-</span><span class="n">mxp</span> <span class="ow">and</span> <span class="n">r</span><span class="o">...|</span><span class="n">msp</span><span class="o">-</span><span class="n">jfk</span><span class="o">-</span><span class="n">mxp</span> <span class="n">retur</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10912</span><span class="o">|</span>   <span class="n">United</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">07</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">3.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">1</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Worst</span> <span class="n">airline</span> <span class="n">I</span> <span class="n">h</span><span class="o">...|</span><span class="n">worst</span> <span class="n">airline</span> <span class="n">i</span> <span class="n">h</span><span class="o">...|</span><span class="n">worst</span> <span class="n">airline</span> <span class="n">eve</span><span class="o">...|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rawdata</span> <span class="o">=</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">raw_cols</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;stop_text&#39;</span><span class="p">])</span>\
                 <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;feat_text&#39;</span><span class="p">,</span><span class="n">remove_features_udf</span><span class="p">(</span><span class="n">rawdata</span><span class="p">[</span><span class="s1">&#39;stop_text&#39;</span><span class="p">]))</span>

<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span>   <span class="nb">id</span><span class="o">|</span>           <span class="n">airline</span><span class="o">|</span>      <span class="n">date</span><span class="o">|</span><span class="n">location</span><span class="o">|</span><span class="n">rating</span><span class="o">|</span>   <span class="n">cabin</span><span class="o">|</span><span class="n">value</span><span class="o">|</span><span class="n">recommended</span><span class="o">|</span>              <span class="n">review</span><span class="o">|</span>           <span class="n">stop_text</span><span class="o">|</span>           <span class="n">feat_text</span><span class="o">|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span><span class="mi">10551</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">2</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="mi">3246</span> <span class="kn">from</span> <span class="nn">...</span><span class="o">|</span><span class="n">flight</span> <span class="mi">3246</span> <span class="n">chica</span><span class="o">...|</span><span class="n">flight</span> <span class="n">chicago</span> <span class="n">mi</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10298</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span>      <span class="n">UK</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">0</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="kn">from</span> <span class="nn">Manch...</span><span class="o">|</span><span class="n">flight</span> <span class="n">manchester</span><span class="o">...|</span><span class="n">flight</span> <span class="n">manchester</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10564</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">5</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">I</span><span class="s1">&#39;m Executive Pla...|i&#39;</span><span class="n">m</span> <span class="n">executive</span> <span class="n">pla</span><span class="o">...|</span><span class="n">executive</span> <span class="n">platinu</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10134</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">8.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">4</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">MSP</span><span class="o">-</span><span class="n">JFK</span><span class="o">-</span><span class="n">MXP</span> <span class="ow">and</span> <span class="n">r</span><span class="o">...|</span><span class="n">msp</span><span class="o">-</span><span class="n">jfk</span><span class="o">-</span><span class="n">mxp</span> <span class="n">retur</span><span class="o">...|</span><span class="n">msp</span> <span class="n">jfk</span> <span class="n">mxp</span> <span class="n">retur</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10912</span><span class="o">|</span>   <span class="n">United</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">07</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">3.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">1</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Worst</span> <span class="n">airline</span> <span class="n">I</span> <span class="n">h</span><span class="o">...|</span><span class="n">worst</span> <span class="n">airline</span> <span class="n">eve</span><span class="o">...|</span><span class="n">worst</span> <span class="n">airline</span> <span class="n">eve</span><span class="o">...|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">rawdata</span> <span class="o">=</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">raw_cols</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;feat_text&#39;</span><span class="p">])</span>\
                  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;tagged_text&#39;</span><span class="p">,</span><span class="n">tag_and_remove_udf</span><span class="p">(</span><span class="n">rawdata</span><span class="p">[</span><span class="s1">&#39;feat_text&#39;</span><span class="p">]))</span>

<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span>   <span class="nb">id</span><span class="o">|</span>           <span class="n">airline</span><span class="o">|</span>      <span class="n">date</span><span class="o">|</span><span class="n">location</span><span class="o">|</span><span class="n">rating</span><span class="o">|</span>   <span class="n">cabin</span><span class="o">|</span><span class="n">value</span><span class="o">|</span><span class="n">recommended</span><span class="o">|</span>              <span class="n">review</span><span class="o">|</span>           <span class="n">feat_text</span><span class="o">|</span>         <span class="n">tagged_text</span><span class="o">|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span><span class="mi">10551</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">2</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="mi">3246</span> <span class="kn">from</span> <span class="nn">...</span><span class="o">|</span><span class="n">flight</span> <span class="n">chicago</span> <span class="n">mi</span><span class="o">...|</span> <span class="n">flight</span> <span class="n">chicago</span> <span class="n">m</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10298</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span>      <span class="n">UK</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">0</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="kn">from</span> <span class="nn">Manch...</span><span class="o">|</span><span class="n">flight</span> <span class="n">manchester</span><span class="o">...|</span> <span class="n">flight</span> <span class="n">mancheste</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10564</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">5</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">I</span><span class="s1">&#39;m Executive Pla...|executive platinu...| executive platin...|</span>
<span class="o">|</span><span class="mi">10134</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">8.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">4</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">MSP</span><span class="o">-</span><span class="n">JFK</span><span class="o">-</span><span class="n">MXP</span> <span class="ow">and</span> <span class="n">r</span><span class="o">...|</span><span class="n">msp</span> <span class="n">jfk</span> <span class="n">mxp</span> <span class="n">retur</span><span class="o">...|</span> <span class="n">msp</span> <span class="n">jfk</span> <span class="n">mxp</span> <span class="n">retu</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10912</span><span class="o">|</span>   <span class="n">United</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">07</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">3.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">1</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Worst</span> <span class="n">airline</span> <span class="n">I</span> <span class="n">h</span><span class="o">...|</span><span class="n">worst</span> <span class="n">airline</span> <span class="n">eve</span><span class="o">...|</span> <span class="n">worst</span> <span class="n">airline</span> <span class="n">ua</span><span class="o">...|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">rawdata</span> <span class="o">=</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">raw_cols</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;tagged_text&#39;</span><span class="p">])</span> \
                  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;lemm_text&#39;</span><span class="p">,</span><span class="n">lemmatize_udf</span><span class="p">(</span><span class="n">rawdata</span><span class="p">[</span><span class="s1">&#39;tagged_text&#39;</span><span class="p">])</span>


<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span>   <span class="nb">id</span><span class="o">|</span>           <span class="n">airline</span><span class="o">|</span>      <span class="n">date</span><span class="o">|</span><span class="n">location</span><span class="o">|</span><span class="n">rating</span><span class="o">|</span>   <span class="n">cabin</span><span class="o">|</span><span class="n">value</span><span class="o">|</span><span class="n">recommended</span><span class="o">|</span>              <span class="n">review</span><span class="o">|</span>         <span class="n">tagged_text</span><span class="o">|</span>           <span class="n">lemm_text</span><span class="o">|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span><span class="mi">10551</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">2</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="mi">3246</span> <span class="kn">from</span> <span class="nn">...</span><span class="o">|</span> <span class="n">flight</span> <span class="n">chicago</span> <span class="n">m</span><span class="o">...|</span><span class="n">flight</span> <span class="n">chicago</span> <span class="n">mi</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10298</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span>      <span class="n">UK</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">0</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="kn">from</span> <span class="nn">Manch...</span><span class="o">|</span> <span class="n">flight</span> <span class="n">mancheste</span><span class="o">...|</span><span class="n">flight</span> <span class="n">manchester</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10564</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">5</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">I</span><span class="s1">&#39;m Executive Pla...| executive platin...|executive platinu...|</span>
<span class="o">|</span><span class="mi">10134</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">8.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">4</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">MSP</span><span class="o">-</span><span class="n">JFK</span><span class="o">-</span><span class="n">MXP</span> <span class="ow">and</span> <span class="n">r</span><span class="o">...|</span> <span class="n">msp</span> <span class="n">jfk</span> <span class="n">mxp</span> <span class="n">retu</span><span class="o">...|</span><span class="n">msp</span> <span class="n">jfk</span> <span class="n">mxp</span> <span class="n">retur</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10912</span><span class="o">|</span>   <span class="n">United</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">07</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">3.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">1</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Worst</span> <span class="n">airline</span> <span class="n">I</span> <span class="n">h</span><span class="o">...|</span> <span class="n">worst</span> <span class="n">airline</span> <span class="n">ua</span><span class="o">...|</span><span class="n">worst</span> <span class="n">airline</span> <span class="n">ual</span><span class="o">...|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="n">rawdata</span> <span class="o">=</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">raw_cols</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;lemm_text&#39;</span><span class="p">])</span> \
                  <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;is_blank&quot;</span><span class="p">,</span> <span class="n">check_blanks_udf</span><span class="p">(</span><span class="n">rawdata</span><span class="p">[</span><span class="s2">&quot;lemm_text&quot;</span><span class="p">]))</span>


<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------+</span>
<span class="o">|</span>   <span class="nb">id</span><span class="o">|</span>           <span class="n">airline</span><span class="o">|</span>      <span class="n">date</span><span class="o">|</span><span class="n">location</span><span class="o">|</span><span class="n">rating</span><span class="o">|</span>   <span class="n">cabin</span><span class="o">|</span><span class="n">value</span><span class="o">|</span><span class="n">recommended</span><span class="o">|</span>              <span class="n">review</span><span class="o">|</span>           <span class="n">lemm_text</span><span class="o">|</span><span class="n">is_blank</span><span class="o">|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------+</span>
<span class="o">|</span><span class="mi">10551</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">2</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="mi">3246</span> <span class="kn">from</span> <span class="nn">...</span><span class="o">|</span><span class="n">flight</span> <span class="n">chicago</span> <span class="n">mi</span><span class="o">...|</span>   <span class="kc">False</span><span class="o">|</span>
<span class="o">|</span><span class="mi">10298</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span>      <span class="n">UK</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">0</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="kn">from</span> <span class="nn">Manch...</span><span class="o">|</span><span class="n">flight</span> <span class="n">manchester</span><span class="o">...|</span>   <span class="kc">False</span><span class="o">|</span>
<span class="o">|</span><span class="mi">10564</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">5</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">I</span><span class="s1">&#39;m Executive Pla...|executive platinu...|   False|</span>
<span class="o">|</span><span class="mi">10134</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">8.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">4</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">MSP</span><span class="o">-</span><span class="n">JFK</span><span class="o">-</span><span class="n">MXP</span> <span class="ow">and</span> <span class="n">r</span><span class="o">...|</span><span class="n">msp</span> <span class="n">jfk</span> <span class="n">mxp</span> <span class="n">retur</span><span class="o">...|</span>   <span class="kc">False</span><span class="o">|</span>
<span class="o">|</span><span class="mi">10912</span><span class="o">|</span>   <span class="n">United</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">07</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">3.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">1</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Worst</span> <span class="n">airline</span> <span class="n">I</span> <span class="n">h</span><span class="o">...|</span><span class="n">worst</span> <span class="n">airline</span> <span class="n">ual</span><span class="o">...|</span>   <span class="kc">False</span><span class="o">|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">monotonically_increasing_id</span>
<span class="c1"># Create Unique ID</span>
<span class="n">rawdata</span> <span class="o">=</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;uid&quot;</span><span class="p">,</span> <span class="n">monotonically_increasing_id</span><span class="p">())</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">rawdata</span><span class="p">[</span><span class="s2">&quot;is_blank&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;False&quot;</span><span class="p">)</span>

<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------+---+</span>
<span class="o">|</span>   <span class="nb">id</span><span class="o">|</span>           <span class="n">airline</span><span class="o">|</span>      <span class="n">date</span><span class="o">|</span><span class="n">location</span><span class="o">|</span><span class="n">rating</span><span class="o">|</span>   <span class="n">cabin</span><span class="o">|</span><span class="n">value</span><span class="o">|</span><span class="n">recommended</span><span class="o">|</span>              <span class="n">review</span><span class="o">|</span>           <span class="n">lemm_text</span><span class="o">|</span><span class="n">is_blank</span><span class="o">|</span><span class="n">uid</span><span class="o">|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------+---+</span>
<span class="o">|</span><span class="mi">10551</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">2</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="mi">3246</span> <span class="kn">from</span> <span class="nn">...</span><span class="o">|</span><span class="n">flight</span> <span class="n">chicago</span> <span class="n">mi</span><span class="o">...|</span>   <span class="kc">False</span><span class="o">|</span>  <span class="mi">0</span><span class="o">|</span>
<span class="o">|</span><span class="mi">10298</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span>      <span class="n">UK</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="n">Business</span><span class="o">|</span>    <span class="mi">0</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Flight</span> <span class="kn">from</span> <span class="nn">Manch...</span><span class="o">|</span><span class="n">flight</span> <span class="n">manchester</span><span class="o">...|</span>   <span class="kc">False</span><span class="o">|</span>  <span class="mi">1</span><span class="o">|</span>
<span class="o">|</span><span class="mi">10564</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">5</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">I</span><span class="s1">&#39;m Executive Pla...|executive platinu...|   False|  2|</span>
<span class="o">|</span><span class="mi">10134</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">8.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">4</span><span class="o">|</span>        <span class="n">YES</span><span class="o">|</span><span class="n">MSP</span><span class="o">-</span><span class="n">JFK</span><span class="o">-</span><span class="n">MXP</span> <span class="ow">and</span> <span class="n">r</span><span class="o">...|</span><span class="n">msp</span> <span class="n">jfk</span> <span class="n">mxp</span> <span class="n">retur</span><span class="o">...|</span>   <span class="kc">False</span><span class="o">|</span>  <span class="mi">3</span><span class="o">|</span>
<span class="o">|</span><span class="mi">10912</span><span class="o">|</span>   <span class="n">United</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">07</span><span class="o">|</span>     <span class="n">USA</span><span class="o">|</span>   <span class="mf">3.0</span><span class="o">|</span> <span class="n">Economy</span><span class="o">|</span>    <span class="mi">1</span><span class="o">|</span>         <span class="n">NO</span><span class="o">|</span><span class="n">Worst</span> <span class="n">airline</span> <span class="n">I</span> <span class="n">h</span><span class="o">...|</span><span class="n">worst</span> <span class="n">airline</span> <span class="n">ual</span><span class="o">...|</span>   <span class="kc">False</span><span class="o">|</span>  <span class="mi">4</span><span class="o">|</span>
<span class="o">+-----+------------------+----------+--------+------+--------+-----+-----------+--------------------+--------------------+--------+---+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">5</span> <span class="n">rows</span>
</pre></div>
</div>
</div></blockquote>
<p># Pipeline for LDA model</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">HashingTF</span><span class="p">,</span> <span class="n">IDF</span><span class="p">,</span> <span class="n">Tokenizer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">NaiveBayes</span><span class="p">,</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.clustering</span> <span class="kn">import</span> <span class="n">LDA</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.evaluation</span> <span class="kn">import</span> <span class="n">MulticlassClassificationEvaluator</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.tuning</span> <span class="kn">import</span> <span class="n">ParamGridBuilder</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.tuning</span> <span class="kn">import</span> <span class="n">CrossValidator</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">IndexToString</span><span class="p">,</span> <span class="n">StringIndexer</span><span class="p">,</span> <span class="n">VectorIndexer</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>

<span class="c1"># Configure an ML pipeline, which consists of tree stages: tokenizer, hashingTF, and nb.</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;lemm_text&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;words&quot;</span><span class="p">)</span>
<span class="c1">#data = tokenizer.transform(data)</span>
<span class="n">vectorizer</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span> <span class="s2">&quot;words&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;rawFeatures&quot;</span><span class="p">)</span>
<span class="n">idf</span> <span class="o">=</span> <span class="n">IDF</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">&quot;rawFeatures&quot;</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">)</span>
<span class="c1">#idfModel = idf.fit(data)</span>

<span class="n">lda</span> <span class="o">=</span> <span class="n">LDA</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s2">&quot;em&quot;</span><span class="p">)</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">stages</span><span class="o">=</span><span class="p">[</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">vectorizer</span><span class="p">,</span><span class="n">idf</span><span class="p">,</span> <span class="n">lda</span><span class="p">])</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple">
<li><p>Results presentation</p></li>
</ol>
<ul class="simple">
<li><p>Topics</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+-----+--------------------+--------------------+</span>
<span class="o">|</span><span class="n">topic</span><span class="o">|</span>         <span class="n">termIndices</span><span class="o">|</span>         <span class="n">termWeights</span><span class="o">|</span>
<span class="o">+-----+--------------------+--------------------+</span>
<span class="o">|</span>    <span class="mi">0</span><span class="o">|</span><span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">483</span><span class="p">,</span> <span class="o">...|</span><span class="p">[</span><span class="mf">0.01349507958269</span><span class="o">...|</span>
<span class="o">|</span>    <span class="mi">1</span><span class="o">|</span><span class="p">[</span><span class="mi">363</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mf">55.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.01247250144447</span><span class="o">...|</span>
<span class="o">|</span>    <span class="mi">2</span><span class="o">|</span><span class="p">[</span><span class="mi">46</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">672</span><span class="p">,</span> <span class="mf">27.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.01188684264641</span><span class="o">...|</span>
<span class="o">|</span>    <span class="mi">3</span><span class="o">|</span><span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span> <span class="mf">152.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.01132638300115</span><span class="o">...|</span>
<span class="o">|</span>    <span class="mi">4</span><span class="o">|</span><span class="p">[</span><span class="mi">201</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">372</span><span class="p">,</span> <span class="mf">69.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.01337529863256</span><span class="o">...|</span>
<span class="o">|</span>    <span class="mi">5</span><span class="o">|</span><span class="p">[</span><span class="mi">122</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mf">4.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.00930415977117</span><span class="o">...|</span>
<span class="o">|</span>    <span class="mi">6</span><span class="o">|</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.01253817708163</span><span class="o">...|</span>
<span class="o">|</span>    <span class="mi">7</span><span class="o">|</span><span class="p">[</span><span class="mi">111</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">341</span><span class="p">,</span> <span class="mf">10.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.01269584954257</span><span class="o">...|</span>
<span class="o">|</span>    <span class="mi">8</span><span class="o">|</span><span class="p">[</span><span class="mi">477</span><span class="p">,</span> <span class="mi">266</span><span class="p">,</span> <span class="mi">297</span><span class="p">,</span> <span class="mf">1.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.01017486869509</span><span class="o">...|</span>
<span class="o">|</span>    <span class="mi">9</span><span class="o">|</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">2.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.01050875237546</span><span class="o">...|</span>
<span class="o">|</span>   <span class="mi">10</span><span class="o">|</span><span class="p">[</span><span class="mi">57</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">411</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.01777350667863</span><span class="o">...|</span>
<span class="o">|</span>   <span class="mi">11</span><span class="o">|</span><span class="p">[</span><span class="mi">293</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">385</span><span class="p">,</span> <span class="mf">4.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.01280305149305</span><span class="o">...|</span>
<span class="o">|</span>   <span class="mi">12</span><span class="o">|</span><span class="p">[</span><span class="mi">116</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mf">1.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.01570714218509</span><span class="o">...|</span>
<span class="o">|</span>   <span class="mi">13</span><span class="o">|</span><span class="p">[</span><span class="mi">433</span><span class="p">,</span> <span class="mi">171</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mf">3.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.00819684813575</span><span class="o">...|</span>
<span class="o">|</span>   <span class="mi">14</span><span class="o">|</span><span class="p">[</span><span class="mi">74</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.01700630002172</span><span class="o">...|</span>
<span class="o">|</span>   <span class="mi">15</span><span class="o">|</span><span class="p">[</span><span class="mi">669</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mf">58.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.00779310974971</span><span class="o">...|</span>
<span class="o">|</span>   <span class="mi">16</span><span class="o">|</span><span class="p">[</span><span class="mi">198</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mf">164.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.01030577084202</span><span class="o">...|</span>
<span class="o">|</span>   <span class="mi">17</span><span class="o">|</span><span class="p">[</span><span class="mi">96</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">569</span><span class="p">,</span> <span class="mf">444.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.01297142577633</span><span class="o">...|</span>
<span class="o">|</span>   <span class="mi">18</span><span class="o">|</span><span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.01306356985169</span><span class="o">...|</span>
<span class="o">|</span>   <span class="mi">19</span><span class="o">|</span><span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">178</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">...|</span><span class="p">[</span><span class="mf">0.00907425683229</span><span class="o">...|</span>
<span class="o">+-----+--------------------+--------------------+</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Topic terms</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">ArrayType</span><span class="p">,</span> <span class="n">StringType</span>

<span class="k">def</span> <span class="nf">termsIdx2Term</span><span class="p">(</span><span class="n">vocabulary</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">termsIdx2Term</span><span class="p">(</span><span class="n">termIndices</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">vocabulary</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">termIndices</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">udf</span><span class="p">(</span><span class="n">termsIdx2Term</span><span class="p">,</span> <span class="n">ArrayType</span><span class="p">(</span><span class="n">StringType</span><span class="p">()))</span>

<span class="n">vectorizerModel</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">stages</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">vocabList</span> <span class="o">=</span> <span class="n">vectorizerModel</span><span class="o">.</span><span class="n">vocabulary</span>
<span class="n">final</span> <span class="o">=</span> <span class="n">ldatopics</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;Terms&quot;</span><span class="p">,</span> <span class="n">termsIdx2Term</span><span class="p">(</span><span class="n">vocabList</span><span class="p">)(</span><span class="s2">&quot;termIndices&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+-----+------------------------------------------------+-------------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="n">topic</span><span class="o">|</span><span class="n">termIndices</span>                                     <span class="o">|</span><span class="n">Terms</span>                                                                                <span class="o">|</span>
<span class="o">+-----+------------------------------------------------+-------------------------------------------------------------------------------------+</span>
<span class="o">|</span><span class="mi">0</span>    <span class="o">|</span><span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">483</span><span class="p">,</span> <span class="mi">292</span><span class="p">,</span> <span class="mi">326</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">808</span><span class="p">,</span> <span class="mi">32</span><span class="p">]</span>      <span class="o">|</span><span class="p">[</span><span class="n">pm</span><span class="p">,</span> <span class="n">plane</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">kid</span><span class="p">,</span> <span class="n">online</span><span class="p">,</span> <span class="n">lga</span><span class="p">,</span> <span class="n">schedule</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">memphis</span><span class="p">,</span> <span class="n">arrive</span><span class="p">]</span>                 <span class="o">|</span>
<span class="o">|</span><span class="mi">1</span>    <span class="o">|</span><span class="p">[</span><span class="mi">363</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">647</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">204</span><span class="p">,</span> <span class="mi">457</span><span class="p">]</span>    <span class="o">|</span><span class="p">[</span><span class="n">dublin</span><span class="p">,</span> <span class="n">class</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">sit</span><span class="p">,</span> <span class="n">entertainment</span><span class="p">,</span> <span class="n">express</span><span class="p">,</span> <span class="n">say</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">dl</span><span class="p">,</span> <span class="n">son</span><span class="p">]</span>                <span class="o">|</span>
<span class="o">|</span><span class="mi">2</span>    <span class="o">|</span><span class="p">[</span><span class="mi">46</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">672</span><span class="p">,</span> <span class="mi">274</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">539</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">279</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>    <span class="o">|</span><span class="p">[</span><span class="n">economy</span><span class="p">,</span> <span class="n">sfo</span><span class="p">,</span> <span class="n">milwaukee</span><span class="p">,</span> <span class="n">decent</span><span class="p">,</span> <span class="n">comfortable</span><span class="p">,</span> <span class="n">iad</span><span class="p">,</span> <span class="k">return</span><span class="p">,</span> <span class="n">united</span><span class="p">,</span> <span class="n">average</span><span class="p">,</span> <span class="n">airline</span><span class="p">]</span><span class="o">|</span>
<span class="o">|</span><span class="mi">3</span>    <span class="o">|</span><span class="p">[</span><span class="mi">76</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">31</span><span class="p">]</span>   <span class="o">|</span><span class="p">[</span><span class="n">didn</span><span class="p">,</span> <span class="n">pay</span><span class="p">,</span> <span class="n">lose</span><span class="p">,</span> <span class="n">different</span><span class="p">,</span> <span class="n">extra</span><span class="p">,</span> <span class="n">bag</span><span class="p">,</span> <span class="n">mile</span><span class="p">,</span> <span class="n">baggage</span><span class="p">,</span> <span class="n">leave</span><span class="p">,</span> <span class="n">day</span><span class="p">]</span>                  <span class="o">|</span>
<span class="o">|</span><span class="mi">4</span>    <span class="o">|</span><span class="p">[</span><span class="mi">201</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">372</span><span class="p">,</span> <span class="mi">692</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">211</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">110</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="n">houston</span><span class="p">,</span> <span class="n">crew</span><span class="p">,</span> <span class="n">heathrow</span><span class="p">,</span> <span class="n">louisville</span><span class="p">,</span> <span class="n">london</span><span class="p">,</span> <span class="n">great</span><span class="p">,</span> <span class="n">denver</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">land</span><span class="p">,</span> <span class="n">jfk</span><span class="p">]</span>          <span class="o">|</span>
<span class="o">|</span><span class="mi">5</span>    <span class="o">|</span><span class="p">[</span><span class="mi">122</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">434</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">934</span><span class="p">,</span> <span class="mi">169</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="n">lhr</span><span class="p">,</span> <span class="n">serve</span><span class="p">,</span> <span class="n">screen</span><span class="p">,</span> <span class="n">entertainment</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">excellent</span><span class="p">,</span> <span class="n">atl</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">newark</span><span class="p">]</span>          <span class="o">|</span>
<span class="o">|</span><span class="mi">6</span>    <span class="o">|</span><span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>       <span class="o">|</span><span class="p">[</span><span class="n">check</span><span class="p">,</span> <span class="n">employee</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">change</span><span class="p">,</span> <span class="n">wait</span><span class="p">,</span> <span class="n">take</span><span class="p">,</span> <span class="n">fll</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">tell</span><span class="p">]</span>                   <span class="o">|</span>
<span class="o">|</span><span class="mi">7</span>    <span class="o">|</span><span class="p">[</span><span class="mi">111</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">341</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">528</span><span class="p">,</span> <span class="mi">844</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">524</span><span class="p">]</span> <span class="o">|</span><span class="p">[</span><span class="n">atlanta</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">toilet</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">washington</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="k">global</span><span class="p">,</span> <span class="n">staff</span><span class="p">,</span> <span class="n">route</span><span class="p">,</span> <span class="n">amsterdam</span><span class="p">]</span>   <span class="o">|</span>
<span class="o">|</span><span class="mi">8</span>    <span class="o">|</span><span class="p">[</span><span class="mi">477</span><span class="p">,</span> <span class="mi">266</span><span class="p">,</span> <span class="mi">297</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">783</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">908</span><span class="p">]</span>   <span class="o">|</span><span class="p">[</span><span class="n">fuel</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">pas</span><span class="p">,</span> <span class="n">boarding</span><span class="p">,</span> <span class="n">seat</span><span class="p">,</span> <span class="n">trip</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">orleans</span><span class="p">,</span> <span class="n">make</span><span class="p">,</span> <span class="n">select</span><span class="p">]</span>              <span class="o">|</span>
<span class="o">|</span><span class="mi">9</span>    <span class="o">|</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">248</span><span class="p">,</span> <span class="mi">302</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">659</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">228</span><span class="p">]</span>    <span class="o">|</span><span class="p">[</span><span class="n">delta</span><span class="p">,</span> <span class="n">lax</span><span class="p">,</span> <span class="n">economy</span><span class="p">,</span> <span class="n">seat</span><span class="p">,</span> <span class="n">london</span><span class="p">,</span> <span class="n">detroit</span><span class="p">,</span> <span class="n">comfo</span><span class="p">,</span> <span class="n">weren</span><span class="p">,</span> <span class="n">entertainment</span><span class="p">,</span> <span class="n">wife</span><span class="p">]</span>      <span class="o">|</span>
<span class="o">|</span><span class="mi">10</span>   <span class="o">|</span><span class="p">[</span><span class="mi">57</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">411</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">661</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">805</span><span class="p">,</span> <span class="mi">733</span><span class="p">]</span>  <span class="o">|</span><span class="p">[</span><span class="n">business</span><span class="p">,</span> <span class="n">class</span><span class="p">,</span> <span class="n">fra</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">lounge</span><span class="p">,</span> <span class="n">excellent</span><span class="p">,</span> <span class="n">syd</span><span class="p">,</span> <span class="n">staff</span><span class="p">,</span> <span class="n">nov</span><span class="p">,</span> <span class="n">mexico</span><span class="p">]</span>            <span class="o">|</span>
<span class="o">|</span><span class="mi">11</span>   <span class="o">|</span><span class="p">[</span><span class="mi">293</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">385</span><span class="p">,</span> <span class="mi">481</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">545</span><span class="p">]</span> <span class="o">|</span><span class="p">[</span><span class="n">march</span><span class="p">,</span> <span class="n">ua</span><span class="p">,</span> <span class="n">manchester</span><span class="p">,</span> <span class="n">phx</span><span class="p">,</span> <span class="n">envoy</span><span class="p">,</span> <span class="n">drink</span><span class="p">,</span> <span class="n">crew</span><span class="p">,</span> <span class="n">american</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">canada</span><span class="p">]</span>               <span class="o">|</span>
<span class="o">|</span><span class="mi">12</span>   <span class="o">|</span><span class="p">[</span><span class="mi">116</span><span class="p">,</span> <span class="mi">218</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">639</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">365</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">136</span><span class="p">]</span> <span class="o">|</span><span class="p">[</span><span class="n">san</span><span class="p">,</span> <span class="n">clt</span><span class="p">,</span> <span class="n">francisco</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">tell</span><span class="p">,</span> <span class="n">captain</span><span class="p">,</span> <span class="n">gate</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">available</span><span class="p">]</span>          <span class="o">|</span>
<span class="o">|</span><span class="mi">13</span>   <span class="o">|</span><span class="p">[</span><span class="mi">433</span><span class="p">,</span> <span class="mi">171</span><span class="p">,</span> <span class="mi">176</span><span class="p">,</span> <span class="mi">339</span><span class="p">,</span> <span class="mi">429</span><span class="p">,</span> <span class="mi">575</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">474</span><span class="p">,</span> <span class="mi">796</span><span class="p">]</span><span class="o">|</span><span class="p">[</span><span class="n">daughter</span><span class="p">,</span> <span class="n">small</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">ba</span><span class="p">,</span> <span class="n">segment</span><span class="p">,</span> <span class="n">proceed</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">passenger</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">similar</span><span class="p">]</span>         <span class="o">|</span>
<span class="o">|</span><span class="mi">14</span>   <span class="o">|</span><span class="p">[</span><span class="mi">74</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">342</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">315</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>     <span class="o">|</span><span class="p">[</span><span class="n">line</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="n">hotel</span><span class="p">,</span> <span class="n">standby</span><span class="p">,</span> <span class="n">atlanta</span><span class="p">,</span> <span class="n">dallas</span><span class="p">,</span> <span class="n">american</span><span class="p">,</span> <span class="n">book</span><span class="p">,</span> <span class="n">get</span><span class="p">]</span>            <span class="o">|</span>
<span class="o">|</span><span class="mi">15</span>   <span class="o">|</span><span class="p">[</span><span class="mi">669</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">561</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">179</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>    <span class="o">|</span><span class="p">[</span><span class="n">fit</span><span class="p">,</span> <span class="n">carry</span><span class="p">,</span> <span class="n">check</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">bathroom</span><span class="p">,</span> <span class="n">ask</span><span class="p">,</span> <span class="n">thing</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">don</span><span class="p">,</span> <span class="n">fly</span><span class="p">]</span>                     <span class="o">|</span>
<span class="o">|</span><span class="mi">16</span>   <span class="o">|</span><span class="p">[</span><span class="mi">198</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">345</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">174</span><span class="p">]</span>  <span class="o">|</span><span class="p">[</span><span class="n">ife</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">nice</span><span class="p">,</span> <span class="n">much</span><span class="p">,</span> <span class="n">business</span><span class="p">,</span> <span class="n">lot</span><span class="p">,</span> <span class="n">dfw</span><span class="p">,</span> <span class="n">great</span><span class="p">,</span> <span class="n">excellent</span><span class="p">,</span> <span class="n">carrier</span><span class="p">]</span>               <span class="o">|</span>
<span class="o">|</span><span class="mi">17</span>   <span class="o">|</span><span class="p">[</span><span class="mi">96</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">569</span><span class="p">,</span> <span class="mi">444</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">568</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">657</span><span class="p">,</span> <span class="mi">505</span><span class="p">]</span>  <span class="o">|</span><span class="p">[</span><span class="n">phl</span><span class="p">,</span> <span class="n">class</span><span class="p">,</span> <span class="n">diego</span><span class="p">,</span> <span class="n">lady</span><span class="p">,</span> <span class="n">food</span><span class="p">,</span> <span class="n">wheelchair</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">serve</span><span class="p">,</span> <span class="n">miami</span><span class="p">,</span> <span class="n">mia</span><span class="p">]</span>                 <span class="o">|</span>
<span class="o">|</span><span class="mi">18</span>   <span class="o">|</span><span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">123</span><span class="p">]</span>       <span class="o">|</span><span class="p">[</span><span class="n">gate</span><span class="p">,</span> <span class="n">pm</span><span class="p">,</span> <span class="n">phoenix</span><span class="p">,</span> <span class="n">connection</span><span class="p">,</span> <span class="n">cancel</span><span class="p">,</span> <span class="n">connect</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">airpo</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">charlotte</span><span class="p">]</span>        <span class="o">|</span>
<span class="o">|</span><span class="mi">19</span>   <span class="o">|</span><span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">178</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">284</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">31</span><span class="p">]</span>         <span class="o">|</span><span class="p">[</span><span class="n">trip</span><span class="p">,</span> <span class="n">counter</span><span class="p">,</span> <span class="n">philadelphia</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">stay</span><span class="p">,</span> <span class="n">way</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">southwest</span><span class="p">,</span> <span class="n">day</span><span class="p">]</span>           <span class="o">|</span>
<span class="o">+-----+------------------------------------------------+-------------------------------------------------------------------------------------+</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>LDA results</p></li>
</ul>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">+-----+------------------+----------+-----------+------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span>   <span class="nb">id</span><span class="o">|</span>           <span class="n">airline</span><span class="o">|</span>      <span class="n">date</span><span class="o">|</span>      <span class="n">cabin</span><span class="o">|</span><span class="n">rating</span><span class="o">|</span>               <span class="n">words</span><span class="o">|</span>            <span class="n">features</span><span class="o">|</span>   <span class="n">topicDistribution</span><span class="o">|</span>
<span class="o">+-----+------------------+----------+-----------+------+--------------------+--------------------+--------------------+</span>
<span class="o">|</span><span class="mi">10551</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>   <span class="n">Business</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="p">[</span><span class="n">flight</span><span class="p">,</span> <span class="n">chicago</span><span class="p">,</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mf">11.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.03640342580508</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10298</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span>   <span class="n">Business</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="p">[</span><span class="n">flight</span><span class="p">,</span> <span class="n">manchest</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.01381306271470</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10564</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span><span class="p">[</span><span class="n">executive</span><span class="p">,</span> <span class="n">plati</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mf">11.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.05063554352934</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10134</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>   <span class="mf">8.0</span><span class="o">|</span><span class="p">[</span><span class="n">msp</span><span class="p">,</span> <span class="n">jfk</span><span class="p">,</span> <span class="n">mxp</span><span class="p">,</span> <span class="n">r</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mf">1.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.01494708959842</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10912</span><span class="o">|</span>   <span class="n">United</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">07</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>   <span class="mf">3.0</span><span class="o">|</span><span class="p">[</span><span class="n">worst</span><span class="p">,</span> <span class="n">airline</span><span class="p">,</span> <span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mf">13.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.04421751181232</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10089</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>   <span class="mf">2.0</span><span class="o">|</span><span class="p">[</span><span class="n">dl</span><span class="p">,</span> <span class="n">mia</span><span class="p">,</span> <span class="n">lax</span><span class="p">,</span> <span class="n">im</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.02158861273876</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10385</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">21</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span><span class="p">[</span><span class="n">flew</span><span class="p">,</span> <span class="n">gla</span><span class="p">,</span> <span class="n">phl</span><span class="p">,</span> <span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mf">14.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.03343845991816</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10249</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">17</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="p">[</span><span class="n">friend</span><span class="p">,</span> <span class="n">book</span><span class="p">,</span> <span class="n">fl</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.02362432562165</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10289</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">12</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span><span class="p">[</span><span class="n">flew</span><span class="p">,</span> <span class="n">air</span><span class="p">,</span> <span class="n">rome</span><span class="p">,</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mf">13.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.01664012816210</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10654</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2012</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>   <span class="mf">8.0</span><span class="o">|</span><span class="p">[</span><span class="n">lhr</span><span class="p">,</span> <span class="n">jfk</span><span class="p">,</span> <span class="n">think</span><span class="p">,</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.01526072330297</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10754</span><span class="o">|</span> <span class="n">American</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">04</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span><span class="p">[</span><span class="n">san</span><span class="p">,</span> <span class="n">diego</span><span class="p">,</span> <span class="n">moli</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mf">2.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.03571177612496</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10646</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2012</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">17</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>   <span class="mf">7.0</span><span class="o">|</span><span class="p">[</span><span class="n">toledo</span><span class="p">,</span> <span class="n">co</span><span class="p">,</span> <span class="n">stop</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.02394775146271</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10097</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">03</span><span class="o">|</span><span class="n">First</span> <span class="n">Class</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span><span class="p">[</span><span class="n">honolulu</span><span class="p">,</span> <span class="n">la</span><span class="p">,</span> <span class="n">fi</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mf">13.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.02008375619661</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10132</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">16</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>   <span class="mf">7.0</span><span class="o">|</span><span class="p">[</span><span class="n">manchester</span><span class="p">,</span> <span class="n">uk</span><span class="p">,</span> <span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.01463126146601</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10560</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">20</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>   <span class="mf">9.0</span><span class="o">|</span><span class="p">[</span><span class="n">first</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">sou</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.04934836409896</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10579</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">25</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>   <span class="mf">0.0</span><span class="o">|</span><span class="p">[</span><span class="n">plane</span><span class="p">,</span> <span class="n">land</span><span class="p">,</span> <span class="n">pm</span><span class="p">,</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.06106959241722</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10425</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>   <span class="mf">3.0</span><span class="o">|</span><span class="p">[</span><span class="n">airway</span><span class="p">,</span> <span class="n">bad</span><span class="p">,</span> <span class="n">pro</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="o">...|</span><span class="p">[</span><span class="mf">0.01770471771322</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10650</span><span class="o">|</span><span class="n">Southwest</span> <span class="n">Airlines</span><span class="o">|</span><span class="mi">2012</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">27</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>   <span class="mf">9.0</span><span class="o">|</span><span class="p">[</span><span class="n">flew</span><span class="p">,</span> <span class="n">jfk</span><span class="p">,</span> <span class="n">lhr</span><span class="p">,</span> <span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mf">1.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.02676226245086</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10260</span><span class="o">|</span>        <span class="n">US</span> <span class="n">Airways</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">03</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>   <span class="mf">1.0</span><span class="o">|</span><span class="p">[</span><span class="n">february</span><span class="p">,</span> <span class="n">air</span><span class="p">,</span> <span class="n">u</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mf">2.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.02887390875079</span><span class="o">...|</span>
<span class="o">|</span><span class="mi">10202</span><span class="o">|</span>   <span class="n">Delta</span> <span class="n">Air</span> <span class="n">Lines</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">14</span><span class="o">|</span>    <span class="n">Economy</span><span class="o">|</span>  <span class="mf">10.0</span><span class="o">|</span><span class="p">[</span><span class="n">aug</span><span class="p">,</span> <span class="n">lhr</span><span class="p">,</span> <span class="n">jfk</span><span class="p">,</span> <span class="n">b</span><span class="o">...|</span><span class="p">(</span><span class="mi">4695</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mf">10.</span><span class="o">..|</span><span class="p">[</span><span class="mf">0.02377704988307</span><span class="o">...|</span>
<span class="o">+-----+------------------+----------+-----------+------+--------------------+--------------------+--------------------+</span>
<span class="n">only</span> <span class="n">showing</span> <span class="n">top</span> <span class="mi">20</span> <span class="n">rows</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Average rating and airlines for each day</p></li>
</ul>
<div class="figure align-center">
<img alt="_images/avg_rating_airlines.png" src="_images/avg_rating_airlines.png" />
</div>
<ul class="simple">
<li><p>Average rating and airlines for each month</p></li>
</ul>
<div class="figure align-center">
<img alt="_images/avg_rating_mon.png" src="_images/avg_rating_mon.png" />
</div>
<ul class="simple">
<li><p>Topic 1 corresponding to time line</p></li>
</ul>
<div class="figure align-center">
<img alt="_images/topic_time.png" src="_images/topic_time.png" />
</div>
<ul class="simple">
<li><p>reviews (documents) relate to topic 1</p></li>
</ul>
<div class="figure align-center">
<img alt="_images/review2topic.png" src="_images/review2topic.png" />
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="socialnetwork.html" class="btn btn-neutral float-right" title="15. Social Network Analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rfm.html" class="btn btn-neutral float-left" title="13. RFM Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Wenqiang Feng
      <span class="lastupdated">
        Last updated on Dec 27, 2021.
      </span>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>